<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"qianguodong.xyz","root":"/","images":"/images","scheme":"Pisces","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="一、整洁代码1 为什么阅读这本书？ 你是个程序员 你想成为更好的程序员  2 读完本书，获得的技能？ 知道更多关于代码的事儿 辨别好代码和糟糕代码的差异 学会如何写出好代码 学会如何将糟糕代码改成好代码  3 写糟糕代码的理由与代价 理由 为了快点完成而赶时间； 只是单纯的为了实现结果，哪怕你的代码过程怎么样都不重要，当结果呈现出你想象中的样子，你便弃之而不顾，可能当你回头再看你写的代码时，你">
<meta property="og:type" content="article">
<meta property="og:title" content="Clean Code!">
<meta property="og:url" content="https://qianguodong.xyz/2018/09/19/reading/2018-09-19-cleancode/index.html">
<meta property="og:site_name" content="Bruce&#39;s Blog">
<meta property="og:description" content="一、整洁代码1 为什么阅读这本书？ 你是个程序员 你想成为更好的程序员  2 读完本书，获得的技能？ 知道更多关于代码的事儿 辨别好代码和糟糕代码的差异 学会如何写出好代码 学会如何将糟糕代码改成好代码  3 写糟糕代码的理由与代价 理由 为了快点完成而赶时间； 只是单纯的为了实现结果，哪怕你的代码过程怎么样都不重要，当结果呈现出你想象中的样子，你便弃之而不顾，可能当你回头再看你写的代码时，你">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://qianguodong.xyz/2018/09/19/reading/pics/994bd262fec543853cd99fe680e857cc.png">
<meta property="og:image" content="https://qianguodong.xyz/2018/09/19/reading/pics/2018-10-26_085430.png">
<meta property="article:published_time" content="2018-09-19T02:22:16.000Z">
<meta property="article:modified_time" content="2020-12-22T12:37:22.829Z">
<meta property="article:author" content="Bruce Qian">
<meta property="article:tag" content="refactor">
<meta property="article:tag" content="clean_code">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://qianguodong.xyz/2018/09/19/reading/pics/994bd262fec543853cd99fe680e857cc.png">


<link rel="canonical" href="https://qianguodong.xyz/2018/09/19/reading/2018-09-19-cleancode/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>
<title>Clean Code! | Bruce's Blog</title>
  



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Bruce's Blog</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">There is no royal road to learning</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E6%95%B4%E6%B4%81%E4%BB%A3%E7%A0%81"><span class="nav-number">1.</span> <span class="nav-text">一、整洁代码</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%98%85%E8%AF%BB%E8%BF%99%E6%9C%AC%E4%B9%A6%EF%BC%9F"><span class="nav-number">1.1.</span> <span class="nav-text">1 为什么阅读这本书？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%AF%BB%E5%AE%8C%E6%9C%AC%E4%B9%A6%EF%BC%8C%E8%8E%B7%E5%BE%97%E7%9A%84%E6%8A%80%E8%83%BD%EF%BC%9F"><span class="nav-number">1.2.</span> <span class="nav-text">2 读完本书，获得的技能？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%86%99%E7%B3%9F%E7%B3%95%E4%BB%A3%E7%A0%81%E7%9A%84%E7%90%86%E7%94%B1%E4%B8%8E%E4%BB%A3%E4%BB%B7"><span class="nav-number">1.3.</span> <span class="nav-text">3 写糟糕代码的理由与代价</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%80%8E%E4%B9%88%E6%98%AF%E6%95%B4%E6%B4%81%E7%9A%84%E4%BB%A3%E7%A0%81%EF%BC%9F"><span class="nav-number">1.4.</span> <span class="nav-text">4 怎么是整洁的代码？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E6%80%BB%E7%BB%93"><span class="nav-number">1.5.</span> <span class="nav-text">5 总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E6%95%B4%E6%B4%81%E4%BB%A3%E7%A0%81%E7%AC%A6%E5%90%88%E4%BB%A5%E4%B8%8B%E7%9B%AE%E6%A0%87"><span class="nav-number">1.5.1.</span> <span class="nav-text">5.1 整洁代码符合以下目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E6%95%B4%E6%B4%81%E4%BB%A3%E7%A0%81%E7%9A%84%E5%BB%BA%E8%AE%AE"><span class="nav-number">1.5.2.</span> <span class="nav-text">5.2 整洁代码的建议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E5%B0%8F%E7%BB%93"><span class="nav-number">1.5.3.</span> <span class="nav-text">5.3 小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E6%9C%89%E6%84%8F%E4%B9%89%E7%9A%84%E5%91%BD%E5%90%8D"><span class="nav-number">2.</span> <span class="nav-text">二、有意义的命名</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%90%8D%E5%89%AF%E5%85%B6%E5%AE%9E"><span class="nav-number">2.1.</span> <span class="nav-text">1. 名副其实</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E5%A6%82%E6%9E%9C%E5%90%8D%E7%A7%B0%E9%9C%80%E8%A6%81%E6%B3%A8%E9%87%8A%E6%9D%A5%E8%A1%A5%E5%85%85%EF%BC%8C%E9%82%A3%E4%B9%88%E8%AF%B4%E6%98%8E%E5%90%8D%E5%AD%97%E6%B2%A1%E5%8F%96%E5%A5%BD"><span class="nav-number">2.1.1.</span> <span class="nav-text">1.1 如果名称需要注释来补充，那么说明名字没取好</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E9%80%89%E6%8B%A9%E4%BD%93%E7%8E%B0%E6%9C%AC%E6%84%8F%E7%9A%84%E5%90%8D%E7%A7%B0%E8%83%BD%E8%AE%A9%E4%BA%BA%E6%9B%B4%E5%AE%B9%E6%98%93%E7%90%86%E8%A7%A3%E5%92%8C%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81"><span class="nav-number">2.1.2.</span> <span class="nav-text">1.2 选择体现本意的名称能让人更容易理解和修改代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E9%81%BF%E5%85%8D%E8%AF%AF%E5%AF%BC"><span class="nav-number">2.2.</span> <span class="nav-text">2 避免误导</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%81%9A%E6%9C%89%E6%84%8F%E4%B9%89%E7%9A%84%E5%8C%BA%E5%88%86"><span class="nav-number">2.3.</span> <span class="nav-text">3 做有意义的区分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BD%BF%E7%94%A8%E8%AF%BB%E7%9A%84%E5%87%BA%E6%9D%A5%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="nav-number">2.4.</span> <span class="nav-text">4 使用读的出来的名称</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E4%BD%BF%E7%94%A8%E5%8F%AF%E6%90%9C%E7%B4%A2%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="nav-number">2.5.</span> <span class="nav-text">5 使用可搜索的名称</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E9%81%BF%E5%85%8D%E5%B0%86%E7%B1%BB%E5%9E%8B%E6%88%96%E4%BD%9C%E7%94%A8%E5%9F%9F%E7%BC%96%E8%BF%9B%E5%90%8D%E7%A7%B0%E4%B8%AD"><span class="nav-number">2.6.</span> <span class="nav-text">6 避免将类型或作用域编进名称中</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E7%B1%BB%E5%90%8D%E5%BA%94%E8%AF%A5%E6%98%AF%E5%90%8D%E8%AF%8D%E6%88%96%E5%90%8D%E8%AF%8D%E7%9F%AD%E8%AF%AD%EF%BC%8C%E6%96%B9%E6%B3%95%E5%90%8D%E5%BA%94%E8%AF%A5%E6%98%AF%E5%8A%A8%E8%AF%8D%E6%88%96%E8%80%85%E5%8A%A8%E8%AF%8D%E7%9F%AD%E8%AF%AD"><span class="nav-number">2.7.</span> <span class="nav-text">7 类名应该是名词或名词短语，方法名应该是动词或者动词短语</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E5%90%8C%E4%B8%80%E6%A6%82%E5%BF%B5%E5%AF%B9%E5%BA%94%E7%BB%9F%E4%B8%80%E4%B8%AA%E8%AF%8D"><span class="nav-number">2.8.</span> <span class="nav-text">8 同一概念对应统一个词</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-%E4%B8%8D%E7%94%A8%E5%8F%8C%E5%85%B3%E8%AF%AD"><span class="nav-number">2.9.</span> <span class="nav-text">9 不用双关语</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-%E4%BD%BF%E7%94%A8%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E9%A2%86%E5%9F%9F%E5%90%8D%E7%A7%B0"><span class="nav-number">2.10.</span> <span class="nav-text">10 使用解决方案领域名称</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E6%B7%BB%E5%8A%A0%E6%9C%89%E6%84%8F%E4%B9%89%E7%9A%84%E8%AF%AD%E5%A2%83%E3%80%81%E4%B8%8D%E8%A6%81%E6%B7%BB%E5%8A%A0%E6%B2%A1%E7%94%A8%E7%9A%84%E8%AF%AD%E5%A2%83"><span class="nav-number">2.11.</span> <span class="nav-text">11 添加有意义的语境、不要添加没用的语境</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E5%87%BD%E6%95%B0"><span class="nav-number">3.</span> <span class="nav-text">三、函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%9F%AD%E5%B0%8F"><span class="nav-number">3.1.</span> <span class="nav-text">1 短小</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%8F%AA%E5%81%9A%E4%B8%80%E4%BB%B6%E4%BA%8B"><span class="nav-number">3.2.</span> <span class="nav-text">2 只做一件事</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%AF%8F%E4%B8%AA%E5%87%BD%E6%95%B0%E4%B8%80%E4%B8%AA%E6%8A%BD%E8%B1%A1%E5%B1%82%E7%BA%A7"><span class="nav-number">3.3.</span> <span class="nav-text">3 每个函数一个抽象层级</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-switch%E8%AF%AD%E5%8F%A5%E4%B8%8D%E5%8F%AF%E9%81%BF%E5%85%8D%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%A4%9A%E6%80%81%E9%9A%90%E8%97%8F%E5%88%B0%E8%BE%83%E4%BD%8E%E7%9A%84%E6%8A%BD%E8%B1%A1%E5%B1%82"><span class="nav-number">3.4.</span> <span class="nav-text">4 switch语句不可避免，使用多态隐藏到较低的抽象层</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E4%BD%BF%E7%94%A8%E6%8F%8F%E8%BF%B0%E6%80%A7%E7%9A%84%E5%90%8D%E7%A7%B0"><span class="nav-number">3.5.</span> <span class="nav-text">5 使用描述性的名称</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0"><span class="nav-number">3.6.</span> <span class="nav-text">6 函数参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E6%97%A0%E5%89%AF%E4%BD%9C%E7%94%A8"><span class="nav-number">3.7.</span> <span class="nav-text">7 无副作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E4%BD%BF%E7%94%A8%E5%BC%82%E5%B8%B8%E4%BB%A3%E6%9B%BF%E8%BF%94%E5%9B%9E%E9%94%99%E8%AF%AF%E7%A0%81"><span class="nav-number">3.8.</span> <span class="nav-text">8 使用异常代替返回错误码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%B0%B1%E6%98%AF%E4%B8%80%E4%BB%B6%E4%BA%8B"><span class="nav-number">3.9.</span> <span class="nav-text">9 错误处理就是一件事</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-Error-java-%E4%BE%9D%E8%B5%96%E7%A3%81%E9%93%81"><span class="nav-number">3.10.</span> <span class="nav-text">10 Error.java 依赖磁铁</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E5%88%AB%E9%87%8D%E5%A4%8D%E8%87%AA%E5%B7%B1"><span class="nav-number">3.11.</span> <span class="nav-text">11 别重复自己</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-%E7%BB%93%E6%9E%84%E5%8C%96%E7%BC%96%E7%A8%8B"><span class="nav-number">3.12.</span> <span class="nav-text">12 结构化编程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-%E5%A6%82%E4%BD%95%E5%86%99%E5%87%BA%E8%BF%99%E6%A0%B7%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-number">3.13.</span> <span class="nav-text">13 如何写出这样的函数</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E6%B3%A8%E9%87%8A"><span class="nav-number">4.</span> <span class="nav-text">四、注释</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%B3%A8%E9%87%8A%E4%B8%8D%E8%83%BD%E7%BE%8E%E5%8C%96%E7%B3%9F%E7%B3%95%E7%9A%84%E4%BB%A3%E7%A0%81"><span class="nav-number">4.1.</span> <span class="nav-text">1 注释不能美化糟糕的代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E7%94%A8%E4%BB%A3%E7%A0%81%E6%9D%A5%E9%98%90%E8%BF%B0"><span class="nav-number">4.2.</span> <span class="nav-text">2 用代码来阐述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%A5%BD%E6%B3%A8%E9%87%8A"><span class="nav-number">4.3.</span> <span class="nav-text">3 好注释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%9D%8F%E6%B3%A8%E9%87%8A"><span class="nav-number">4.4.</span> <span class="nav-text">4 坏注释</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E6%A0%BC%E5%BC%8F"><span class="nav-number">5.</span> <span class="nav-text">五、格式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%9B%AE%E7%9A%84"><span class="nav-number">5.1.</span> <span class="nav-text">1.目的</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%9E%82%E7%9B%B4%E6%A0%BC%E5%BC%8F"><span class="nav-number">5.2.</span> <span class="nav-text">2.垂直格式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-Java%E6%BA%90%E4%BB%A3%E7%A0%81%E6%96%87%E4%BB%B6%E6%9C%89%E5%A4%9A%E5%A4%A7%EF%BC%9F%EF%BC%88%E4%BB%A5%E5%A6%82%E4%B8%8B%E4%BB%A3%E7%A0%81%E4%B8%BA%E4%BE%8B%EF%BC%8C%E5%A4%9A%E6%95%B0%E4%B8%BA200%E8%A1%8C%EF%BC%8C%E4%B8%8D%E8%B6%85%E8%BF%87500%E8%A1%8C%EF%BC%89"><span class="nav-number">5.2.1.</span> <span class="nav-text">2.1 Java源代码文件有多大？（以如下代码为例，多数为200行，不超过500行）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E5%9E%82%E7%9B%B4%E6%96%B9%E5%90%91%E7%9A%84%E5%8C%BA%E9%9A%94%EF%BC%88%E7%A9%BA%E7%99%BD%E8%A1%8C%EF%BC%89"><span class="nav-number">5.2.2.</span> <span class="nav-text">2.2 垂直方向的区隔（空白行）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E5%9E%82%E7%9B%B4%E6%96%B9%E5%90%91%E7%9A%84%E9%9D%A0%E8%BF%91"><span class="nav-number">5.2.3.</span> <span class="nav-text">2.3 垂直方向的靠近</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E5%9E%82%E7%9B%B4%E8%B7%9D%E7%A6%BB"><span class="nav-number">5.2.4.</span> <span class="nav-text">2.4 垂直距离</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-%E5%9E%82%E7%9B%B4%E9%A1%BA%E5%BA%8F"><span class="nav-number">5.2.5.</span> <span class="nav-text">2.5 垂直顺序</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%A8%AA%E5%90%91%E6%A0%BC%E5%BC%8F"><span class="nav-number">5.3.</span> <span class="nav-text">3. 横向格式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E6%B0%B4%E5%B9%B3%E6%96%B9%E5%90%91%E7%9A%84%E5%8C%BA%E9%9A%94%E4%B8%8E%E9%9D%A0%E8%BF%91"><span class="nav-number">5.3.1.</span> <span class="nav-text">3.1 水平方向的区隔与靠近</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E6%B0%B4%E5%B9%B3%E5%AF%B9%E9%BD%90"><span class="nav-number">5.3.2.</span> <span class="nav-text">3.2 水平对齐</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E7%BC%A9%E8%BF%9B"><span class="nav-number">5.3.3.</span> <span class="nav-text">3.3 缩进</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E5%9B%A2%E9%98%9F%E8%A7%84%E5%88%99"><span class="nav-number">5.3.4.</span> <span class="nav-text">3.4 团队规则</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%AF%B9%E8%B1%A1%E4%B8%8E%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-number">6.</span> <span class="nav-text">六、对象与数据结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E3%80%81%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%8F%8D%E5%AF%B9%E7%A7%B0%E6%80%A7"><span class="nav-number">6.1.</span> <span class="nav-text">2. 数据、对象的反对称性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-The-Law-of-Demeter-%E5%BE%97%E5%A2%A8%E5%BF%92%E8%80%B3%E5%AE%9A%E5%BE%8B-%E8%BF%AA%E7%B1%B3%E7%89%B9%E6%B3%95%E5%88%99"><span class="nav-number">6.2.</span> <span class="nav-text">3. The Law of Demeter (得墨忒耳定律&#x2F;迪米特法则)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">7.</span> <span class="nav-text">七、错误处理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-%E4%BD%BF%E7%94%A8%E5%BC%82%E5%B8%B8%E8%80%8C%E9%9D%9E%E8%BF%94%E5%9B%9E%E7%A0%81"><span class="nav-number">7.1.</span> <span class="nav-text">7.1 使用异常而非返回码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-%E5%85%88%E5%86%99try-catch-finally%E8%AF%AD%E5%8F%A5"><span class="nav-number">7.2.</span> <span class="nav-text">7.2 先写try-catch-finally语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%8F%AF%E6%8E%A7%E5%BC%82%E5%B8%B8-unchecked-exception"><span class="nav-number">7.3.</span> <span class="nav-text">7.3 使用不可控异常(unchecked exception)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-4-%E7%BB%99%E5%87%BA%E5%BC%82%E5%B8%B8%E5%8F%91%E7%94%9F%E7%9A%84%E7%8E%AF%E5%A2%83%E8%AF%B4%E6%98%8E"><span class="nav-number">7.4.</span> <span class="nav-text">7.4 给出异常发生的环境说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-5-%E4%BE%9D%E8%B0%83%E7%94%A8%E8%80%85%E9%9C%80%E8%A6%81%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8"><span class="nav-number">7.5.</span> <span class="nav-text">7.5 依调用者需要定义异常</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-6-%E5%AE%9A%E4%B9%89%E5%B8%B8%E8%A7%84%E6%B5%81%E7%A8%8B"><span class="nav-number">7.6.</span> <span class="nav-text">7.6 定义常规流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-7-%E5%88%AB%E8%BF%94%E5%9B%9Enull%E5%80%BC"><span class="nav-number">7.7.</span> <span class="nav-text">7.7 别返回null值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-8-%E5%88%AB%E4%BC%A0%E9%80%92null%E5%80%BC"><span class="nav-number">7.8.</span> <span class="nav-text">7.8 别传递null值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-9-%E5%B0%8F%E8%8A%82"><span class="nav-number">7.9.</span> <span class="nav-text">7.9 小节</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A5%E5%85%85"><span class="nav-number">7.10.</span> <span class="nav-text">补充</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#java%E7%9A%84%E5%BC%82%E5%B8%B8%E5%88%86%E7%B1%BB"><span class="nav-number">7.10.1.</span> <span class="nav-text">java的异常分类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#java%E5%BC%82%E5%B8%B8%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">7.10.2.</span> <span class="nav-text">java异常的最佳实践</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AB%E3%80%81Boundaries"><span class="nav-number">8.</span> <span class="nav-text">八、Boundaries</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-Using-Third-Party-Code"><span class="nav-number">8.1.</span> <span class="nav-text">8.1 Using Third-Party Code</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-Exploring-and-Learning-Boundaries"><span class="nav-number">8.2.</span> <span class="nav-text">8.2 Exploring and Learning Boundaries</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-Learning-log4j"><span class="nav-number">8.3.</span> <span class="nav-text">8.3 Learning log4j</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-4-Learning-Tests-Are-Better-Than-Free"><span class="nav-number">8.4.</span> <span class="nav-text">8.4 Learning Tests Are Better Than Free</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-5-Using-Code-That-Does-Not-Yet-Exist"><span class="nav-number">8.5.</span> <span class="nav-text">8.5 Using Code That Does Not Yet Exist</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-6-Clean-Boundaries"><span class="nav-number">8.6.</span> <span class="nav-text">8.6 Clean Boundaries</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B9%9D%E3%80%81Unit-Tests"><span class="nav-number">9.</span> <span class="nav-text">九、Unit Tests</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#9-1-The-Three-Laws-of-TDD"><span class="nav-number">9.1.</span> <span class="nav-text">9.1 The Three Laws of TDD</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-2-Keeping-Tests-Clean"><span class="nav-number">9.2.</span> <span class="nav-text">9.2 Keeping Tests Clean</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-3-Clean-Tests"><span class="nav-number">9.3.</span> <span class="nav-text">9.3 Clean Tests</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-1-Domain-Specific-Testing-Language"><span class="nav-number">9.3.1.</span> <span class="nav-text">9.3.1 Domain-Specific Testing Language</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-2-A-Dual-Standard"><span class="nav-number">9.3.2.</span> <span class="nav-text">9.3.2 A Dual Standard</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-4-One-Assert-per-Test"><span class="nav-number">9.4.</span> <span class="nav-text">9.4 One Assert per Test</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-4-1-Single-Concept-per-Test"><span class="nav-number">9.4.1.</span> <span class="nav-text">9.4.1 Single Concept per Test</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-5-F-I-R-S-T"><span class="nav-number">9.5.</span> <span class="nav-text">9.5 F.I.R.S.T.</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-6-Conclusion"><span class="nav-number">9.6.</span> <span class="nav-text">9.6 Conclusion</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%81%E3%80%81Classes"><span class="nav-number">10.</span> <span class="nav-text">十、Classes</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#10-1-%E7%B1%BB%E7%9A%84%E7%BB%84%E7%BB%87"><span class="nav-number">10.1.</span> <span class="nav-text">10.1 类的组织</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-2-%E7%B1%BB%E5%BA%94%E8%AF%A5%E7%9F%AD%E5%B0%8F"><span class="nav-number">10.2.</span> <span class="nav-text">10.2 类应该短小</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-1-%E5%8D%95%E4%B8%80%E6%9D%83%E8%B4%A3%E5%8E%9F%E5%88%99"><span class="nav-number">10.2.1.</span> <span class="nav-text">10.2.1 单一权责原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-2-%E5%86%85%E8%81%9A"><span class="nav-number">10.2.2.</span> <span class="nav-text">10.2.2 内聚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-3-%E4%BF%9D%E5%AD%98%E5%86%85%E8%81%9A%E6%80%A7%E5%B0%B1%E4%BC%9A%E5%BE%97%E5%88%B0%E8%AE%B8%E5%A4%9A%E7%9F%AD%E5%B0%8F%E7%9A%84%E7%B1%BB"><span class="nav-number">10.2.3.</span> <span class="nav-text">10.2.3 保存内聚性就会得到许多短小的类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-3-%E4%B8%BA%E4%BA%86%E4%BF%AE%E6%94%B9%E8%80%8C%E7%BB%84%E7%BB%87"><span class="nav-number">10.3.</span> <span class="nav-text">10.3 为了修改而组织</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E7%B3%BB%E7%BB%9F"><span class="nav-number">11.</span> <span class="nav-text">十一、系统</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BE%85%E8%A1%A5%E5%85%85"><span class="nav-number">11.1.</span> <span class="nav-text">* 待补充 *</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E8%BF%AD%E8%BF%9B"><span class="nav-number">12.</span> <span class="nav-text">十二、迭进</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#12-1-%E8%BF%90%E8%A1%8C%E6%89%80%E6%9C%89%E6%B5%8B%E8%AF%95"><span class="nav-number">12.1.</span> <span class="nav-text">12.1  运行所有测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-2-%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D"><span class="nav-number">12.2.</span> <span class="nav-text">12.2 不可重复</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-3-%E8%A1%A8%E8%BE%BE%E4%BA%86%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E6%84%8F%E5%9B%BE"><span class="nav-number">12.3.</span> <span class="nav-text">12.3 表达了程序员的意图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-4-%E5%B0%BD%E5%8F%AF%E8%83%BD%E5%87%8F%E5%B0%91%E7%B1%BB%E5%92%8C%E6%96%B9%E6%B3%95%E7%9A%84%E6%95%B0%E9%87%8F"><span class="nav-number">12.4.</span> <span class="nav-text">12.4 尽可能减少类和方法的数量</span></a></li></ol></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Bruce Qian"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Bruce Qian</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/qianguodong" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;qianguodong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:goldon.qian@gmail.com" title="E-Mail → mailto:goldon.qian@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://qianguodong.xyz/2018/09/19/reading/2018-09-19-cleancode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Bruce Qian">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bruce's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Clean Code!
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-09-19 10:22:16" itemprop="dateCreated datePublished" datetime="2018-09-19T10:22:16+08:00">2018-09-19</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-12-22 20:37:22" itemprop="dateModified" datetime="2020-12-22T20:37:22+08:00">2020-12-22</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <a id="more"></a>

<h1 id="一、整洁代码"><a href="#一、整洁代码" class="headerlink" title="一、整洁代码"></a>一、整洁代码</h1><h2 id="1-为什么阅读这本书？"><a href="#1-为什么阅读这本书？" class="headerlink" title="1 为什么阅读这本书？"></a>1 为什么阅读这本书？</h2><ul>
<li>你是个程序员</li>
<li>你想成为更好的程序员</li>
</ul>
<h2 id="2-读完本书，获得的技能？"><a href="#2-读完本书，获得的技能？" class="headerlink" title="2 读完本书，获得的技能？"></a>2 读完本书，获得的技能？</h2><ul>
<li>知道更多关于代码的事儿</li>
<li>辨别好代码和糟糕代码的差异</li>
<li>学会如何写出好代码</li>
<li>学会如何将糟糕代码改成好代码</li>
</ul>
<h2 id="3-写糟糕代码的理由与代价"><a href="#3-写糟糕代码的理由与代价" class="headerlink" title="3 写糟糕代码的理由与代价"></a>3 写糟糕代码的理由与代价</h2><ul>
<li>理由<ul>
<li>为了快点完成而赶时间；</li>
<li>只是单纯的为了实现结果，哪怕你的代码过程怎么样都不重要，当结果呈现出你想象中的样子，你便弃之而不顾，可能当你回头再看你写的代码时，你都忘记是怎样的思路;</li>
<li>随便先写点代码出来，结果出现后稍后再整理;</li>
</ul>
</li>
<li>代价<ul>
<li>久而久之，以你习惯写出的代码，在团队中，你可能会被嫌弃;</li>
<li>可能会因为你的原因拖延整个项目组的时间；</li>
<li>需求变了，你像重新来过一样再改，重复重复，这团乱麻越来越大，直到束手无策，团队生产力下降。</li>
</ul>
</li>
</ul>
<h2 id="4-怎么是整洁的代码？"><a href="#4-怎么是整洁的代码？" class="headerlink" title="4 怎么是整洁的代码？"></a>4 怎么是整洁的代码？</h2><ul>
<li><p>Bjarne Stroustrup（C++发明者）</p>
<ul>
<li>我喜欢优雅和高效的代码，代码逻辑应当直接了当，叫缺陷难以隐藏；</li>
<li>尽量减少依赖关系，使之便于维护；</li>
<li>依据某种分层战略完善错误处理代码；性能调至最优，省得引诱别人做没有必要的优化，搞出一堆混乱来，整洁的代码只做好一件事。</li>
</ul>
</li>
<li><p>Ron Jeffries</p>
<ul>
<li>能通过所有的测试；</li>
<li>没有重复代码；</li>
<li>体现系统中的全部设计理念；</li>
<li>包含尽量少的实体、比如类、方法、函数等。</li>
</ul>
</li>
</ul>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5 总结"></a>5 总结</h2><h3 id="5-1-整洁代码符合以下目标"><a href="#5-1-整洁代码符合以下目标" class="headerlink" title="5.1 整洁代码符合以下目标"></a>5.1 整洁代码符合以下目标</h3><ul>
<li>1.职责明确，没有多余；</li>
<li>2.减少依赖，便于维护；</li>
<li>3.高效。</li>
</ul>
<h3 id="5-2-整洁代码的建议"><a href="#5-2-整洁代码的建议" class="headerlink" title="5.2 整洁代码的建议"></a>5.2 整洁代码的建议</h3><ul>
<li>有意义的命名，代码应通过其字面表达含义；</li>
<li>没有重复代码；</li>
<li>全面覆盖的单元测试；</li>
<li>提供清晰、尽量少的API；</li>
<li>完美的错误处理代码，不要忽略细节；</li>
<li>性能调至最优，省得引诱别人做没规矩的优化；</li>
<li>尽量少的依赖关系，便于维护；</li>
<li>尽量少的实体，比如类、方法、函数等；</li>
<li>整洁的代码（类/函数/模块）只做好一件事；</li>
<li>整洁的代码看起来专为解决那个问题而存在；</li>
<li>整洁的代码简单直接，从不隐藏设计者的意图；</li>
<li>整洁的代码看起来像是某位特别在意她的人写的，没有改进的余地；</li>
<li>整洁的代码浅显易懂，绝不故作高深；</li>
</ul>
<h3 id="5-3-小结"><a href="#5-3-小结" class="headerlink" title="5.3 小结"></a>5.3 小结</h3><p>每一位程序员就像是位艺术家，把写代码当做自己在雕刻一件艺术品，一定要美观到最精致，呈现给人们一种赏心悦目的景象。</p>
<h1 id="二、有意义的命名"><a href="#二、有意义的命名" class="headerlink" title="二、有意义的命名"></a>二、有意义的命名</h1><p>变量、函数、参数、类、包、文件。很多地方都需要命名，怎么样命名才能简洁明了。</p>
<h2 id="1-名副其实"><a href="#1-名副其实" class="headerlink" title="1. 名副其实"></a>1. 名副其实</h2><p>选个好名字要花时间，但省下来的时间比花掉的多。一旦有好的命名，就换掉旧的。</p>
<h3 id="1-1-如果名称需要注释来补充，那么说明名字没取好"><a href="#1-1-如果名称需要注释来补充，那么说明名字没取好" class="headerlink" title="1.1 如果名称需要注释来补充，那么说明名字没取好"></a>1.1 如果名称需要注释来补充，那么说明名字没取好</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 差的命名</span></span><br><span class="line"><span class="keyword">int</span> d;          <span class="comment">// 消逝的时间，以日计算。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 好的命名</span></span><br><span class="line"><span class="keyword">int</span> elapsedTimeInDays;</span><br><span class="line"><span class="keyword">int</span> daysSinceCreation;</span><br><span class="line"><span class="keyword">int</span> daysSinceModification;</span><br><span class="line"><span class="keyword">int</span> fileAgeInDays;</span><br></pre></td></tr></table></figure>
<h3 id="1-2-选择体现本意的名称能让人更容易理解和修改代码"><a href="#1-2-选择体现本意的名称能让人更容易理解和修改代码" class="headerlink" title="1.2 选择体现本意的名称能让人更容易理解和修改代码"></a>1.2 选择体现本意的名称能让人更容易理解和修改代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;<span class="keyword">int</span>[]&gt; getThem() &#123;</span><br><span class="line">    List&lt;<span class="keyword">int</span>[]&gt; list1 = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">int</span>[]&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span>[] x : theList) &#123;</span><br><span class="line">        <span class="keyword">if</span> (x[<span class="number">0</span>] == <span class="number">4</span>) &#123;</span><br><span class="line">            list1.add(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码的问题：</p>
<ul>
<li>theList中是什么类型的东西</li>
<li>theList零下标条目的意义是什么</li>
<li>值4的意义是什么</li>
<li>我怎么使用返回的列表</li>
</ul>
<p>问题的答案没体现在代码段中，而这本就是它们应该在的地方。比如，我们正在开发一款扫雷游戏，我们发现盘面是名为theList的单元格列表，那就将其名称改为gameBoard。</p>
<p>盘面上每个单元格都用一个简单数组表示。我们还发现，零下标条目是一种状态的值，而这种状态值为4表示为“已标记”。只要改为有意义的名称，代码就会得到相当程度的改进。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;<span class="keyword">int</span>[]&gt; getFlaggedCells() &#123;</span><br><span class="line">    List&lt;<span class="keyword">int</span>[]&gt; flaggedCells = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span>[] cell : gameBoard) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cell[STAUS_VALUE] == FLAGGED) &#123;</span><br><span class="line">            flaggedCells.add(cell);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flaggedCells;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还可以更进一步，不用int数组表示单元格，而是另写一个类。该类包括一个名副其实的函数（称为isFlagged），从而掩盖住那个魔术数（就是那个4）。于是得到函数的新版本：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Cell&gt; <span class="title">getFlaggedCells</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;Cell&gt; flaggedCells = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Cell cell : gameBoard) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cell.isFlagged()) &#123;</span><br><span class="line">            flaggedCells.add(cell);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flaggedCells;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-避免误导"><a href="#2-避免误导" class="headerlink" title="2 避免误导"></a>2 避免误导</h2><p>程序员必须避免留下掩盖代码本意的错误线索。应当避免使用与本意相悖的词。</p>
<p>别用accountList来指称一组账号，除非它真的是List类型（即便容器就是一个List，最好也别在名称中写出容器类型名）。如果包含账号的容器并非真是个List，就会引起错误的判断。所以，用accountGroup或bunchOfAccounts，甚至直接用accounts都会好一些。</p>
<h2 id="3-做有意义的区分"><a href="#3-做有意义的区分" class="headerlink" title="3 做有意义的区分"></a>3 做有意义的区分</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">copyChars</span><span class="params">(<span class="keyword">char</span> a1[],<span class="keyword">char</span> a2[])</span></span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;a1.length;i++)&#123;</span><br><span class="line">    a2[i]=a1[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果参数名称改为source和destination ，这个函数就会像样很多。</p>
<p>废话都是冗余的，Variable一词 永远不应当出现在变量名中;<br>Table一词永远不应当出现在表名中;<br>NameString 会比 Name好吗，难道Name 会是一个浮点数不成？<br>如有一个Customer的类，有又一个CustomerObject的类。是不是就凌乱了。  </p>
<h2 id="4-使用读的出来的名称"><a href="#4-使用读的出来的名称" class="headerlink" title="4 使用读的出来的名称"></a>4 使用读的出来的名称</h2><p>能读出来的名称更容易记忆。如果名称读不出来，讨论的时候就像个傻鸟。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Date genymdhms <span class="comment">// 生成日期，年、月、日、时、分、秒</span></span><br><span class="line"></span><br><span class="line">Date generationTimestamp;</span><br></pre></td></tr></table></figure>

<h2 id="5-使用可搜索的名称"><a href="#5-使用可搜索的名称" class="headerlink" title="5 使用可搜索的名称"></a>5 使用可搜索的名称</h2><p>找<code>MAX_CLASSES_PER_STUDENT</code>比找数字7要容易得多。同样字母e也不是个便于搜索的变量名。因为太常见了。</p>
<p>单字母名称仅用于短方法中的局部变量。名称长短应与其作用域大小相对应。如果变量或常量可能在代码中多处使用，则应赋予其以便于搜索的名字。</p>
<h2 id="6-避免将类型或作用域编进名称中"><a href="#6-避免将类型或作用域编进名称中" class="headerlink" title="6 避免将类型或作用域编进名称中"></a>6 避免将类型或作用域编进名称中</h2><ul>
<li>匈牙利语标记法（Hungarian Notation,HN）<br>早期编译器不做类型检查，程序员需要用匈牙利语标记法（Hungarian Notation,HN）来帮助自己记住类型</li>
</ul>
<p>例如szCmdLine的前缀sz代表string end of zero.以0 结尾的字符串。strPhone,代表Phone是字符串类型。</p>
<p>而今，大部分语言是<strong>强类型</strong>的，代码编辑环境都已经先进到在编译开始前就侦测到类型错误的程度！所以匈牙利语标记法和其他类似的格式编码都多余了。</p>
<p>匈牙利语标记法加了修改变量，函数，或类的名称或类型的难度。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PhoneNumber phoneString;</span><br><span class="line"><span class="comment">//类型变化时，名称并未变化。</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>成员前缀<br>也不必用 m_ 前缀来标明成员变量。应当把类和函数做得足够小，消除对成员前缀的需要。</p>
</li>
<li><p>接口和实现<br>接口前导字母I被滥用。</p>
</li>
</ul>
<h2 id="7-类名应该是名词或名词短语，方法名应该是动词或者动词短语"><a href="#7-类名应该是名词或名词短语，方法名应该是动词或者动词短语" class="headerlink" title="7 类名应该是名词或名词短语，方法名应该是动词或者动词短语"></a>7 类名应该是名词或名词短语，方法名应该是动词或者动词短语</h2><p>类名如Customer、WikiPage、Account。避免使用Manager、Processor、Data或Info这样的类名</p>
<p>方法名如postPayment、deletePage或save。属性访问器、修改器或断言应该根据其值命名，并依Javabean标准加上get、set和is前缀。</p>
<h2 id="8-同一概念对应统一个词"><a href="#8-同一概念对应统一个词" class="headerlink" title="8 同一概念对应统一个词"></a>8 同一概念对应统一个词</h2><p>比如get、fetch、retrieve表达的含义差不多，尽量保持多个类使用同一种写法。</p>
<p>Controller、Manager、Driver含义相近，尽量保持一致。</p>
<h2 id="9-不用双关语"><a href="#9-不用双关语" class="headerlink" title="9 不用双关语"></a>9 不用双关语</h2><p>避免将同一个单词用于不同的目的。代码作者应该尽力写出易于理解的代码。</p>
<p>比如add、insert、append之间的区别要搞清楚，对于方法的命名要清晰。</p>
<h2 id="10-使用解决方案领域名称"><a href="#10-使用解决方案领域名称" class="headerlink" title="10 使用解决方案领域名称"></a>10 使用解决方案领域名称</h2><p>代码是给程序员读的，用计算机领域类的术语来命名是一个很好的做法。比如AccountVisitor、JobQueue这种。</p>
<p>如果不能用程序员熟悉的术语来命名，就采用所涉问题的领域名称命名。</p>
<h2 id="11-添加有意义的语境、不要添加没用的语境"><a href="#11-添加有意义的语境、不要添加没用的语境" class="headerlink" title="11 添加有意义的语境、不要添加没用的语境"></a>11 添加有意义的语境、不要添加没用的语境</h2><p>如果你有命名良好的类、函数或命名空间来放置名称，给读者提供语境是最好不过了。如果没有，就用最后一招———给名称添加前缀。</p>
<p>比如，你有名为firstName、lastName、street、hourseNumber、city、state变量，搁一块儿的时候，很明确是一个地址。如果只是在一个方法中单独的看到一个state变量呢，你会理所当然得推断是一个地址吗？</p>
<p>可以添加前缀addrFirstName、addrLastName、addrState来提供语境。</p>
<p>假设有一个名为“加油站豪华版”(Gas Station Deluxe)的应用，在其中给每个类添加GSD前缀就不是什么好点子了。</p>
<h1 id="三、函数"><a href="#三、函数" class="headerlink" title="三、函数"></a>三、函数</h1><h2 id="1-短小"><a href="#1-短小" class="headerlink" title="1 短小"></a>1 短小</h2><p>函数的第一个规则就是要短小。短小才精悍，浓缩的都是精华。函数短小的好处：</p>
<ul>
<li>对于大部分大脑不是特别发达的人，10个10行的函数可能比一个100行的函数理解起来更容易。</li>
<li>如果给每个“小函数”能起一个具有说明性的名字，那么整个流程读下来会更清晰，而且可以增加代码自解释的作用。</li>
<li>短小的函数便于在电脑屏中完整的显示出来，不需要上下去滚动屏幕。</li>
<li>函数二十行最佳。</li>
<li>函数的缩进层级不应该超过二层。</li>
</ul>
<h2 id="2-只做一件事"><a href="#2-只做一件事" class="headerlink" title="2 只做一件事"></a>2 只做一件事</h2><p>函数应该做好一件事，做好这件事，只做这件事—单一职责原则</p>
<h2 id="3-每个函数一个抽象层级"><a href="#3-每个函数一个抽象层级" class="headerlink" title="3 每个函数一个抽象层级"></a>3 每个函数一个抽象层级</h2><p>让代码拥有自顶向下的阅读顺序，函数中的语句都要在同一个抽象层级上。</p>
<p>函数中混杂不同抽象层级，让人迷惑。读者可能无法判断某个表达式是基础概念还是细节。</p>
<h2 id="4-switch语句不可避免，使用多态隐藏到较低的抽象层"><a href="#4-switch语句不可避免，使用多态隐藏到较低的抽象层" class="headerlink" title="4 switch语句不可避免，使用多态隐藏到较低的抽象层"></a>4 switch语句不可避免，使用多态隐藏到较低的抽象层</h2><p>switch语句天生就是要做N件事，不幸地是我们总无法避开，不过还是能够确保每个switch语句都埋藏在较低的抽象层，而且永远不重复。</p>
<h2 id="5-使用描述性的名称"><a href="#5-使用描述性的名称" class="headerlink" title="5 使用描述性的名称"></a>5 使用描述性的名称</h2><p>花时间给函数取个好的具有描述性的名字是很值得的，不要害怕长名字。函数功能越集中、越短小越容易取名字，如果你发现你对你的函数很难取名字的时候，是该考虑这个函数是否需要进行拆分了。</p>
<h2 id="6-函数参数"><a href="#6-函数参数" class="headerlink" title="6 函数参数"></a>6 函数参数</h2><p>最理想的参数数量是零，其次是一，再次是二，应尽量避免三。有足够特殊的理由才能用三个以上参数——所以无论如何也不要这么做。</p>
<p>函数尽量不要有标识参数。向函数传入boolean值简直就是骇人听闻的做法。</p>
<p>如果函数看起来需要两个、三个或三个以上的参数，就说明其中一些参数应该封装为类了。例如，下面两个声明的差别：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Circle <span class="title">makeCircle</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> y, <span class="keyword">double</span> radius)</span></span>;</span><br><span class="line"><span class="function">Circle <span class="title">makeCircle</span><span class="params">(Point center, <span class="keyword">double</span> radius)</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="7-无副作用"><a href="#7-无副作用" class="headerlink" title="7 无副作用"></a>7 无副作用</h2><p>副作用是一种谎言。函数承诺只做一件事，但还是会做其他被藏起来的事。</p>
<h2 id="8-使用异常代替返回错误码"><a href="#8-使用异常代替返回错误码" class="headerlink" title="8 使用异常代替返回错误码"></a>8 使用异常代替返回错误码</h2><p>返回错误码可能导致更深层次的嵌套结构。当返回错误码时就是在要求调用者立即处理错误。如果使用异常代替返回错误码，错误处理代码就能从主路径代码中分离出来，得到简化。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 嵌套结构层次深</span></span><br><span class="line"><span class="keyword">if</span> (deletePage(page) == E_OK) &#123;</span><br><span class="line">    <span class="keyword">if</span> (registry.deleteReference(page.name) == E_OK) &#123;</span><br><span class="line">        <span class="keyword">if</span> (configKeys.deleteKey(page.name.makeKey()) == E_OK) &#123;</span><br><span class="line">            logger.log(<span class="string">&quot;page deleted&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.log(configKey not deleted);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        logger.log(<span class="string">&quot;deleteReference from registry failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    logger.log(<span class="string">&quot;deleted failed&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> E_ERROR;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  使用异常处理代替返回错误码</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    deletePage(page);</span><br><span class="line">    registry.deleteReference(page.name);</span><br><span class="line">    configKeys.deleteKey(page.name.makeKey());</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    logger.log(e.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-错误处理就是一件事"><a href="#9-错误处理就是一件事" class="headerlink" title="9 错误处理就是一件事"></a>9 错误处理就是一件事</h2><p>函数应该只做一件事。错误处理就是一件事。因此，处理错误的函数不该做其他事。意味着如果关键字try在某个函数中存在，它就该是这个函数的第一个单词，而且在catch/finaly代码块后面也不该有其他内容。</p>
<h2 id="10-Error-java-依赖磁铁"><a href="#10-Error-java-依赖磁铁" class="headerlink" title="10 Error.java 依赖磁铁"></a>10 Error.java 依赖磁铁</h2><p>返回错误码通常意味着某处有个类或是枚举，定义了所有错误码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Error</span> </span>&#123;</span><br><span class="line">    OK,</span><br><span class="line">    INVALID,</span><br><span class="line">    NO_SUCH,</span><br><span class="line">    LOCKED,</span><br><span class="line">    OUT_OF_RESOURCES,</span><br><span class="line">    WAITING_FOR_EVENT,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样的类就是一块依赖磁铁，其他许多类都得导入和使用它。当Error枚举修改时，所有这些其他类都需要重新编译和部署。</p>
<p>使用异常替代错误码，新异常就可以从异常类派生出来，无需重新编译或重新部署。</p>
<h2 id="11-别重复自己"><a href="#11-别重复自己" class="headerlink" title="11 别重复自己"></a>11 别重复自己</h2><p>重复可能是软件中一切邪恶的根源。许多原则与实践规则都是为了控制与消除重复而创建的。</p>
<h2 id="12-结构化编程"><a href="#12-结构化编程" class="headerlink" title="12 结构化编程"></a>12 结构化编程</h2><p>Dijkstra认为，每个函数、函数中的每个代码块都应该有一个入口、一个出口。遵循这些规则，意味着在每个函数中只该有一个return语句，循环中不能有break或continue语句，而且永永远远不能有任何goto语句。</p>
<p>这个规范对于小函数帮助不大，只有在大函数中才有明显的好处。</p>
<h2 id="13-如何写出这样的函数"><a href="#13-如何写出这样的函数" class="headerlink" title="13 如何写出这样的函数"></a>13 如何写出这样的函数</h2><p>跟写文章一样，先想什么就写什么，然后不断打磨。初稿也许粗陋无序，你就斟酌推敲，直至达到你心目中的样子。</p>
<h1 id="四、注释"><a href="#四、注释" class="headerlink" title="四、注释"></a>四、注释</h1><p>若编程语言足够有表达力，或者我们擅长于用这些语言来表达意图，就不那么需要注释—也许根本不需要。</p>
<p>注释的恰当用法是弥补我们在用代码表达意图时遭遇的失败。如果你发现自己需要写注释，再想想看是否有办法通过代码来表达。</p>
<h2 id="1-注释不能美化糟糕的代码"><a href="#1-注释不能美化糟糕的代码" class="headerlink" title="1 注释不能美化糟糕的代码"></a>1 注释不能美化糟糕的代码</h2><p>少量而准确是注释比大量而毫无意义的注释更有用。大量无用的注释会打乱阅读代码时的思路，也会增加滚动屏幕的成本。</p>
<h2 id="2-用代码来阐述"><a href="#2-用代码来阐述" class="headerlink" title="2 用代码来阐述"></a>2 用代码来阐述</h2><p>有时候，代码本身不足以解释其行为。幸运的是，很多时候我们都可以把代码写地能解释自己的行为。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Check to see if the employee is eligible for full benefits</span></span><br><span class="line"><span class="keyword">if</span> ((employee.flags &amp; HOURLY_DAY) &amp;&amp;  (employee.age &gt; <span class="number">65</span>))</span><br></pre></td></tr></table></figure>
<p>改成这样怎么样？</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (employee.isEligibleForFullBenefits())</span><br></pre></td></tr></table></figure>

<h2 id="3-好注释"><a href="#3-好注释" class="headerlink" title="3 好注释"></a>3 好注释</h2><p>有些注释是必须的，也是有利的。不过要记住，唯一真正的好注释是你想办法不去写的注释。</p>
<ul>
<li><p>法律信息<br>版本及著作权声明就是有理由在每个源文件开头注释处放置的内容</p>
</li>
<li><p>提供信息的注释</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// format matched kk:mm:ss EEE, MMM dd, yyyy</span></span><br><span class="line">Pattern timeMatcher = Pattern.compile(<span class="string">&quot;\\d*:\\d*:\\d* \\w*, \\w* \\d*, \\d*&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>注释说明，该正则表达式意在匹配一个经由SimpleDateFormat.format函数利用特定格式字符串格式化的时间和日期。</p>
<p>这类注释有时管用，但更好的方式是尽量利用函数名称表达信息。</p>
</li>
<li><p>对意图的解释。注释可以提供某个决定背后的故事。</p>
</li>
<li><p>阐释。注释可以解释某些难懂的参数或返回值的意义。</p>
</li>
<li><p>警示。有时，用于警示其他程序员会出现某种后果的注释也是有用的。</p>
</li>
<li><p>TODO注释。TODO大多都是程序员的自我安慰、自欺欺人。</p>
</li>
<li><p>放大。可以用来放大某种不合理之物的重要性。</p>
</li>
<li><p>公共API中的Javadoc</p>
</li>
</ul>
<h2 id="4-坏注释"><a href="#4-坏注释" class="headerlink" title="4 坏注释"></a>4 坏注释</h2><p>大多数注释都属此类。通常，坏注释都是糟糕代码的支撑或借口，或者对错误决策的修正，基本上等于程序员自说自话。</p>
<ul>
<li><p>喃喃自语<br>写一些只有作者自己知道含义的注释，就是喃喃自语。</p>
</li>
<li><p>多余的注释<br>相比代码本身无法提供更过的信息就是多余的注释。比如没有证明代码的意义，也没有给出代码的意图或逻辑。读这种注释还不如读代码。</p>
</li>
<li><p>误导性注释<br>注释不够精确，和代码本身表达的含义不一致，容易误导程序员。</p>
</li>
<li><p>循规式注释<br>谓每个函数都要有Javadoc或每个变量都要有注释的规矩全然是愚蠢可笑的。这类注释突然让代码变得散乱，满口胡言，令人迷惑不解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> title The title of the CD</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> author The author of the CD</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tracks The number of tracks on the CD</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> durationInMinutes The duration of the CD in minutes</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCD</span><span class="params">(String title, String author, <span class="keyword">int</span> tracks, <span class="keyword">int</span> rationInMinutes)</span> </span>&#123;</span><br><span class="line">   CD cd = <span class="keyword">new</span> CD();</span><br><span class="line">   cd.title = title;</span><br><span class="line">   cd.author = author;</span><br><span class="line">   d.tracks = tracks;</span><br><span class="line">   cd.duration = durationInMinutes;</span><br><span class="line">   cdList.add(cd);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>日志式注释<br>有人会在每次编辑代码时，在模块开始处添加一条注释。这类注释就像是一种记录每次修改的日志。</p>
<p>很久以前，在模块开始处创建并维护这些记录还算有道理。那时，我们还没有源代码控制系统可用。如今，这种冗长的记录只会让模块变得凌乱不堪，应当全部删除。  </p>
</li>
<li><p>废话注释<br>对显然之事喋喋不休，毫无新意。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Default constructor</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">protected</span> <span class="title">AnnualDateRule</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** The day of the month. */</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">int</span> dayOfMonth;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the day of the month</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the day of the month</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getDayOfMonth</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dayOfMonth;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>可怕的废话<br>Javadoc也可能是废话。下列Javadoc(摘自某知名开源库)的目的是什么？ 答案：无。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** The name. */</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** The version */</span></span><br><span class="line"><span class="keyword">private</span> String version;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** The licenseName */</span></span><br><span class="line"><span class="keyword">private</span> String licenseName;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** The version. */</span></span><br><span class="line"><span class="keyword">private</span> String info;</span><br></pre></td></tr></table></figure></li>
<li><p>能用函数或变量时就别用注释。体现了要使名称更具表达性，能表达它自身的意图。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// does the module from the global list &lt;mod&gt; depend on the</span></span><br><span class="line"><span class="comment">// subsystem we are part of ?</span></span><br><span class="line"><span class="keyword">if</span> (smodule.getDependSubsystems().contains(subSysMod.getSubSystem()))</span><br></pre></td></tr></table></figure>
<p>可以改成以下没有注释的版本：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ArrayList moduleDependees = smodule.getDependSubsystems();</span><br><span class="line">String ourSubSystem = subSysMod.getSubSystem();</span><br><span class="line"><span class="keyword">if</span> (moduleDependees.contains(ourSubSystem))</span><br></pre></td></tr></table></figure>
</li>
<li><p>位置标记。#######################################之类的。<br>有时，程序员喜欢在源代码中标记某个特别位置。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Actions &#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
</li>
<li><p>括号后面的注释。通过注释来表明这个括号与哪个括号是一对的。<br>有时，程序员会在括号后面放置特殊的注释，尽管这对于含有深度嵌套结构的长函数可能有意义，但只会给我们更愿意编写的短小、封装的函数带来混乱。如果你发现自己想标记右括号，其实应该做的是缩短函数。</p>
</li>
<li><p>归属与署名。同样应该是代码控制系统应该做的事。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* Added by Rick *&#x2F;</span><br></pre></td></tr></table></figure>
<p>版本控制系统非常善于记住是谁在何时添加了什么。没必要用小小的签名搞脏代码。</p>
</li>
<li><p>注释掉的代码。<br>直接把代码注释掉是讨厌的做法。别这么干！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">InputStreamResponse response = <span class="keyword">new</span> InputStreamResponse();</span><br><span class="line">resonpse.setBody(formatter.getResultStream(), formatter.getByteCount());</span><br><span class="line"><span class="comment">// InputStream resultsStream = formatter.getResultStream();</span></span><br><span class="line"><span class="comment">// StreamReader reader = new StreamReader(resultStream);</span></span><br><span class="line"><span class="comment">// response.setContent(reader.read(formatter.getByteCount()));</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>HTML注释<br>源码中包含HTML注释让人讨厌，难以阅读。</p>
</li>
<li><p>非本地信息。<br>假如你一定要写注释，请确保它描述了离它最近的代码。别在本地注释的上下文环境中包含出系统级的信息。<br>下面的例子，除了可怕的冗余之外，还包含了系统级的默认端口信息。但是这个函数完全没控制那个所谓的默认值。假如那个值更改了，无法担保这个注释也会跟着修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * port on which fitnesse would run. Default to &lt;b&gt;8082&lt;/b&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> fitnessePort</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFitnessePort</span><span class="params">(<span class="keyword">int</span> fitnessPort)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.fitnessePort = fitnessePort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>信息过多<br>别在注释中添加有趣的历史性话题或者无关的细节描述。</p>
</li>
</ul>
<ul>
<li>不明显的联系<br>注释及其描述的代码之间的联系应该是显而易见。如果你不嫌麻烦要写注释，至少让读者能看着注释和代码，并且理解注释所谈何物。</li>
</ul>
<p>注释应该起着辅助的作用，而不应该“喧宾夺主”。好的注释在于提供有用信息、或者方便程序员获取有用信息。而坏的信息在于冗余，甚至是错误，一般它们对提高对系统的认识不会提供任何帮助，反而会分散注意力。</p>
<h1 id="五、格式"><a href="#五、格式" class="headerlink" title="五、格式"></a>五、格式</h1><h2 id="1-目的"><a href="#1-目的" class="headerlink" title="1.目的"></a>1.目的</h2><ul>
<li>代码格式关乎沟通，而沟通是开发者的头等大事。</li>
<li>代码风格&amp;可读性影响到可维护性&amp;扩展性。</li>
</ul>
<h2 id="2-垂直格式"><a href="#2-垂直格式" class="headerlink" title="2.垂直格式"></a>2.垂直格式</h2><h3 id="2-1-Java源代码文件有多大？（以如下代码为例，多数为200行，不超过500行）"><a href="#2-1-Java源代码文件有多大？（以如下代码为例，多数为200行，不超过500行）" class="headerlink" title="2.1 Java源代码文件有多大？（以如下代码为例，多数为200行，不超过500行）"></a>2.1 Java源代码文件有多大？（以如下代码为例，多数为200行，不超过500行）</h3><ul>
<li>短文件通常比长文件更容易理解。</li>
</ul>
<h3 id="2-2-垂直方向的区隔（空白行）"><a href="#2-2-垂直方向的区隔（空白行）" class="headerlink" title="2.2 垂直方向的区隔（空白行）"></a>2.2 垂直方向的区隔（空白行）</h3><p>以如下代码为例，每个协程之间，都有空白行隔开。每个空白行都是一条线索，标识出新的独立概念。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;GBASEUP results</span><br><span class="line">go func() &#123;</span><br><span class="line">   res, err :&#x3D; ReqProForResults(fmt.Sprintf(ProUrl, PaasProAddress, GBASE_INDEX_UP))</span><br><span class="line">   upResults &lt;- Ack&#123;Result: res, Error: err&#125;</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;GBASEUP results</span><br><span class="line">go func() &#123;</span><br><span class="line">   res, err :&#x3D; ReqProForResults(fmt.Sprintf(ProUrl, PaasProAddress, GBASE_INDEX_NODE_STATUS))</span><br><span class="line">   statusResults &lt;- Ack&#123;Result: res, Error: err&#125;</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;cluster results</span><br><span class="line">go func() &#123;</span><br><span class="line">   res, err :&#x3D; ReqProForResults(fmt.Sprintf(ProUrl, PaasProAddress, GBASE_INDEX_CLUSTER))</span><br><span class="line">   ClusterResults &lt;- Ack&#123;Result: res, Error: err&#125;</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
<h3 id="2-3-垂直方向的靠近"><a href="#2-3-垂直方向的靠近" class="headerlink" title="2.3 垂直方向的靠近"></a>2.3 垂直方向的靠近</h3><p>关系密切的概念应该相互靠近（除非有很好的理由，否则不要把关系密切的概念放到不同的文件中）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upResults :&#x3D; make(chan Ack)</span><br><span class="line">statusResults :&#x3D; make(chan Ack)</span><br><span class="line"></span><br><span class="line">ClusterResults :&#x3D; make(chan Ack)</span><br><span class="line">runtime.GOMAXPROCS(runtime.NumCPU())</span><br></pre></td></tr></table></figure>
<h3 id="2-4-垂直距离"><a href="#2-4-垂直距离" class="headerlink" title="2.4 垂直距离"></a>2.4 垂直距离</h3><ul>
<li>局部变量声明应尽可能靠近其使用位置</li>
<li>实例变量(Java)应在类的顶部声明（设计良好的类中，实例变量至少是被大多数方法使用）</li>
<li>相关函数，存在调用关系或相似操作应放在一起，相关性越强，彼此距离越短</li>
</ul>
<h3 id="2-5-垂直顺序"><a href="#2-5-垂直顺序" class="headerlink" title="2.5 垂直顺序"></a>2.5 垂直顺序</h3><p>自上向下展示函数调用依赖顺序，且调用者尽可能放在被调用者上方。</p>
<h2 id="3-横向格式"><a href="#3-横向格式" class="headerlink" title="3. 横向格式"></a>3. 横向格式</h2><ul>
<li>一行代码应该有多宽？（60个字符以下占70%以上）</li>
<li>尽力保持代码行短小；</li>
<li>遵循无需拖动滚动条到右边的原则。（考虑到显示器越来越宽，推荐上限120个字符）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public Map deleteJobs(@PathParam(&quot;jobName&quot;) String jobName,</span><br></pre></td></tr></table></figure>


</li>
</ul>
<h3 id="3-1-水平方向的区隔与靠近"><a href="#3-1-水平方向的区隔与靠近" class="headerlink" title="3.1 水平方向的区隔与靠近"></a>3.1 水平方向的区隔与靠近</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int a &#x3D; 1;</span><br><span class="line"></span><br><span class="line">System.out.println(&quot;abc&quot;);</span><br></pre></td></tr></table></figure>
<p>乘法因子之间不加空格，加减法用空格隔开，因为加减法优先级较低。（但多数格式化工具都会漠视运算符优先级）</p>
<h3 id="3-2-水平对齐"><a href="#3-2-水平对齐" class="headerlink" title="3.2 水平对齐"></a>3.2 水平对齐</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">type Resource struct &#123;</span><br><span class="line">   GClusterMem         string  &#96;json:&quot;gclustermem&quot;&#96;</span><br><span class="line">   GNodeMem            string  &#96;json:&quot;gnodemem&quot;&#96;</span><br><span class="line">   SyncServerMem       float64 &#96;json:&quot;syncservermem&quot;&#96;</span><br><span class="line">   NodeCpuPercent      float64 &#96;json:&quot;nodecpupercent&quot;&#96;</span><br><span class="line">   NodeMemPercent      float64 &#96;json:&quot;nodemempercent&quot;&#96;</span><br><span class="line">   NodeDiskUsed        float64 &#96;json:&quot;nodediskused&quot;&#96;</span><br><span class="line">   NodeDiskTotal       float64 &#96;json:&quot;nodedisktotal&quot;&#96;</span><br><span class="line">   NodeDiskUsedPercent float64 &#96;json:&quot;nodediskusedpercent&quot;&#96;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-缩进"><a href="#3-3-缩进" class="headerlink" title="3.3 缩进"></a>3.3 缩进</h3><ul>
<li>大多数的类声明不缩进；</li>
<li>类中的方法相对类缩进一个层级；</li>
<li>方法的实现相对方法声明缩进一个层级……</li>
</ul>
<p>//违反缩进规则示例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public String render() throws Exception &#123;return &quot;&quot;; &#125;</span><br></pre></td></tr></table></figure>
<p>//作者的建议</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public String render() throws Exception &#123;</span><br><span class="line">	return &quot;&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-4-团队规则"><a href="#3-4-团队规则" class="headerlink" title="3.4 团队规则"></a>3.4 团队规则</h3><p>一组开发者应当认同一种格式风格（团队说了算）</p>
<h1 id="六、对象与数据结构"><a href="#六、对象与数据结构" class="headerlink" title="六、对象与数据结构"></a>六、对象与数据结构</h1><p>##　1. 数据抽象<br>当我们构建一个实体类时,会为变量设置为private,再为变量提供set/get方法,想一想为什么要这么做?实际上,即使变量都是私有,我们通过变量的set/get方法操作变量时,实现仍然被曝光了,那为何不直接将变量设置为public,然后直接操作变量呢?</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public interface Vehicle &#123;</span><br><span class="line">	double getFuelTankCapacityInGallons();</span><br><span class="line">	double getGallonsOfGasoline();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public interface Vehicle &#123;</span><br><span class="line">	double getPercentFuelRemaining();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>隐藏实现关乎抽象！类并不简单地用getter/setter将变量推向外部，而是曝露抽象接口，以便用户无需了解数据的实现就能操作数据本体。傻乐着乱加getter/setter，是最坏的选择。</p>
<h2 id="2-数据、对象的反对称性"><a href="#2-数据、对象的反对称性" class="headerlink" title="2. 数据、对象的反对称性"></a>2. 数据、对象的反对称性</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public class Square &#123;</span><br><span class="line">    public Point topLeft;</span><br><span class="line">    public double side;</span><br><span class="line">&#125;</span><br><span class="line">public class Rectangle &#123;</span><br><span class="line">    public Point topLeft;</span><br><span class="line">    public double height;</span><br><span class="line">    public double width;</span><br><span class="line">&#125;</span><br><span class="line">public class Circle &#123;</span><br><span class="line">    public Point topLeft;</span><br><span class="line">    public double radius;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Geometry &#123;</span><br><span class="line">    public double PI &#x3D; 3.1415926;</span><br><span class="line">    public double area(Object shape) throws NoSuchShapeException</span><br><span class="line">    &#123;   if(shape instanceof Square) &#123;</span><br><span class="line">            Square s &#x3D; (Square)shape;</span><br><span class="line">            return s.side * s.side;</span><br><span class="line">        &#125;</span><br><span class="line">        else if(shape instanceof Rectangle) &#123;</span><br><span class="line">            Rectangle r &#x3D; (Rectangle)shape;</span><br><span class="line">            return r.width * r.height;</span><br><span class="line">        &#125;</span><br><span class="line">        else if(shape instanceof Circle) &#123;</span><br><span class="line">            Circle c &#x3D; (Circle)shape;</span><br><span class="line">            return PI * c.radius * c.radius;</span><br><span class="line">        &#125;</span><br><span class="line">        throw new NoSuchShapeException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>考虑：</p>
<ul>
<li>1.如果给Geometry类添加一个primeter()函数会怎样？（形状类根本不受影响）</li>
<li>2.如果添加一个新形状会怎样？（修改Geometry类中的所有函数）<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">public class Square implements Shape &#123;</span><br><span class="line">    private Point topLeft;</span><br><span class="line">    private double side;</span><br><span class="line"></span><br><span class="line">    public double area() &#123;</span><br><span class="line">        return side * side;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Rectangle implements Shape &#123;</span><br><span class="line">    private Point topLeft;</span><br><span class="line">    private double height;</span><br><span class="line">    private double width;</span><br><span class="line"></span><br><span class="line">    public double area() &#123;</span><br><span class="line">        return height * width;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Circle implements Shape &#123;</span><br><span class="line">    private Point topLeft;</span><br><span class="line">    private double radius;</span><br><span class="line">    public double PI &#x3D; 3.1415926;</span><br><span class="line"></span><br><span class="line">    public double area() &#123;</span><br><span class="line">        return PI * radius*radius;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>考虑：</p>
<ul>
<li>1.如果添加一个primeter()函数会怎样？（所有形状的类都要做修改）</li>
<li>2.如果添加一个新形状会怎样？（现有的函数不会受到影响）</li>
</ul>
<p><code>总结： 过程式代码难以添加数据结构，因为必须修改所有函数。面向对象代码难以添加新函数，因为必须修改所有类。所以需要根据系统不同的需求采取不同的编程策略。</code></p>
<h2 id="3-The-Law-of-Demeter-得墨忒耳定律-迪米特法则"><a href="#3-The-Law-of-Demeter-得墨忒耳定律-迪米特法则" class="headerlink" title="3. The Law of Demeter (得墨忒耳定律/迪米特法则)"></a>3. The Law of Demeter (得墨忒耳定律/迪米特法则)</h2><p>也叫做“最少知识原则”，是一种开发软件的设计原理。指一个对象应当对其他的对象有尽可能少的了解，方法不应调用由任何函数返回的对象的方法。</p>
<p>一个简单例子是，人可以命令一条狗叫，但是不应该直接指挥狗的嘴来叫。应该由狗去指挥控制它的嘴如何叫。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">public class Mouth &#123;</span><br><span class="line">    public void bark() &#123;</span><br><span class="line">        System.out.println(&quot;wang wang!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class Dog &#123;</span><br><span class="line">    private Mouth mouth;</span><br><span class="line"></span><br><span class="line">    public Mouth getMouth() &#123;</span><br><span class="line">        return mouth;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class Human &#123;</span><br><span class="line">    public void command(Dog dog) &#123;</span><br><span class="line">        dog.getMouth().bark();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class Mouth &#123;</span><br><span class="line">    public void bark() &#123;</span><br><span class="line">        System.out.println(&quot;wang wang!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Dog &#123;</span><br><span class="line">    private Mouth mouth;</span><br><span class="line"></span><br><span class="line">    private Mouth getMouth() &#123;</span><br><span class="line">        return mouth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	public void bark() &#123;</span><br><span class="line">		mouth.bark();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Human &#123;</span><br><span class="line">    public void command(Dog dog) &#123;</span><br><span class="line">        dog.bark();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>迪米特法则的初衷在于降低类之间的耦合。由于每个类尽量减少对其他类的依赖，因此，很容易使得系统的功能模块功能独立，相互之间不存在（或很少有）依赖关系。</p>
<h1 id="七、错误处理"><a href="#七、错误处理" class="headerlink" title="七、错误处理"></a>七、错误处理</h1><p>why：</p>
<blockquote>
<p>简言之，可能会出错，当错误发生时，程序员就有责任确保代码正常工作。</p>
</blockquote>
<hr>
<p>how：</p>
<h2 id="7-1-使用异常而非返回码"><a href="#7-1-使用异常而非返回码" class="headerlink" title="7.1 使用异常而非返回码"></a>7.1 使用异常而非返回码</h2><p>通过返回码指示错误，必需在调用函数或者方法后立即检查错误。而错误检查常常会被遗漏，而导致更严重的错误，如空指针异常等。</p>
<p>正确的做法是遇到错误时抛出异常，然后在调用代码是决定捕获异常。</p>
<p>举个反例，这个代码真心搞不懂在干嘛：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">SecHandle</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> r.Method != http.MethodPost &#123;</span><br><span class="line">		log.WithField(<span class="string">&quot;security&quot;</span>, <span class="string">&quot;os auth deliver&quot;</span>).Errorf(<span class="string">&quot;method not allowed : %s&quot;</span>, r.Method)</span><br><span class="line">		w.WriteHeader(http.StatusOK)</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(fmt.Sprintf(<span class="string">&quot;&#123;\&quot;result\&quot;:\&quot;unknown method : %s\&quot;&#125;&quot;</span>, r.Method)))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	buf, err := ioutil.ReadAll(r.Body)</span><br><span class="line">	<span class="keyword">defer</span> r.Body.Close()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.WithField(<span class="string">&quot;security&quot;</span>, <span class="string">&quot;os auth deliver&quot;</span>).Error(<span class="string">&quot;read request body failed, errors: %v&quot;</span>, err)</span><br><span class="line">		w.WriteHeader(http.StatusOK)</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(<span class="string">&quot;&#123;\&quot;result\&quot;:\&quot;read request body failed\&quot;&#125;&quot;</span>))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> sec Security</span><br><span class="line">	jsonErr := json.Unmarshal(buf, &amp;sec)</span><br><span class="line">	<span class="keyword">if</span> jsonErr != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.WithField(<span class="string">&quot;security&quot;</span>, <span class="string">&quot;os auth deliver&quot;</span>).Error(<span class="string">&quot;parse request body failed, errors: %v&quot;</span>, err)</span><br><span class="line">		w.WriteHeader(http.StatusOK)</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(<span class="string">&quot;&#123;\&quot;result\&quot;:\&quot;parse request body failed\&quot;&#125;&quot;</span>))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	clearPassword, err := base64.StdEncoding.DecodeString(sec.Password)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.WithField(<span class="string">&quot;security&quot;</span>, <span class="string">&quot;os password deliver&quot;</span>).Error(<span class="string">&quot;decode password failed: %v&quot;</span>, err)</span><br><span class="line">		w.WriteHeader(http.StatusOK)</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(<span class="string">&quot;&#123;\&quot;result\&quot;:\&quot;decode password failed\&quot;&#125;&quot;</span>))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	conf := ssh.ClientConfig&#123;</span><br><span class="line">		User: sec.Username,</span><br><span class="line">		Auth: []ssh.AuthMethod&#123;ssh.Password(<span class="keyword">string</span>(clearPassword))&#125;,</span><br><span class="line">		HostKeyCallback: <span class="function"><span class="keyword">func</span><span class="params">(hostname <span class="keyword">string</span>, remote net.Addr, key ssh.PublicKey)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">		&#125;,</span><br><span class="line">		Timeout: time.Second,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	client, err := ssh.Dial(<span class="string">&quot;tcp&quot;</span>, fmt.Sprintf(<span class="string">&quot;%s:%s&quot;</span>, sec.IP, <span class="string">&quot;22&quot;</span>), &amp;conf)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &amp;&amp; strings.Contains(err.Error(), <span class="string">&quot;unable to authenticate&quot;</span>) &#123;</span><br><span class="line">		log.WithField(<span class="string">&quot;security&quot;</span>, <span class="string">&quot;os auth deliver&quot;</span>).</span><br><span class="line">			Errorf(<span class="string">&quot;invalid password or username(%s) for host:%s, error : %v&quot;</span>, sec.Username, sec.IP, err)</span><br><span class="line">		w.WriteHeader(http.StatusOK)</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(<span class="string">&quot;&#123;\&quot;result\&quot;:\&quot;invalid password/username\&quot;&#125;&quot;</span>))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> client.Close()</span><br><span class="line"></span><br><span class="line">	nodeSecMap.Store(sec.IP, sec)</span><br><span class="line">	w.WriteHeader(http.StatusOK)</span><br><span class="line">	w.Write([]<span class="keyword">byte</span>(<span class="string">&quot;&#123;\&quot;result\&quot;:\&quot;ok\&quot;&#125;&quot;</span>))</span><br><span class="line">	log.WithField(<span class="string">&quot;security&quot;</span>, <span class="string">&quot;os password deliver&quot;</span>).Warnf(<span class="string">&quot;deliver auth of host:%s successfully&quot;</span>, sec.IP)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="7-2-先写try-catch-finally语句"><a href="#7-2-先写try-catch-finally语句" class="headerlink" title="7.2 先写try-catch-finally语句"></a>7.2 先写try-catch-finally语句</h2><p>try-catch-finally语句中的try部分代码是一个随时可以取消的过程，就像是一个事务，通过catch部分接住，将程序维持在一个可以持续运行的状态。</p>
<p><strong><code>try-catch-finally</code>能够帮你定义代码的用户期望什么，无论try代码执行过程如何都一样</strong></p>
<p>如下面的示例, 无论<code>collect(register)</code>方法发生什么，prometheus都能够看到正确的metrics格式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> CollectorRegistry registry = <span class="keyword">new</span> CollectorRegistry(<span class="keyword">true</span>);</span><br><span class="line">    resp.setStatus(HttpServletResponse.SC_OK);</span><br><span class="line">    resp.setContentType(TextFormat.CONTENT_TYPE_004);</span><br><span class="line"></span><br><span class="line">    increaseAndRegisterCounter(registry, totalScraped);</span><br><span class="line">    <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Collector.getCollector().collect(registry);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">        increaseAndRegisterCounter(registry, errors);</span><br><span class="line">        logger.error(<span class="string">&quot;scrape gbase metrics failed, cause : &quot;</span> + e.getMessage(), e);</span><br><span class="line">    &#125;</span><br><span class="line">    setAndRegisterGauge(registry, duration, System.currentTimeMillis() - start);</span><br><span class="line">    logger.warn(<span class="string">&quot;@@@prometheus scrape at &quot;</span> + fullDataStr(start));</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-3-使用不可控异常-unchecked-exception"><a href="#7-3-使用不可控异常-unchecked-exception" class="headerlink" title="7.3 使用不可控异常(unchecked exception)"></a>7.3 使用不可控异常(unchecked exception)</h2><p>可控异常(checked exception)的问题：</p>
<p>使用可控异常违反了开放/闭合原则，如果你在方法中抛出可控异常，而catch语句在多个层级以上，则在catch语句和抛出异常的方法之间每个方法签名上都要声明该可控异常。也就意味着对较低层级的业务逻辑的修改将会波及到高层级的代码。</p>
<h2 id="7-4-给出异常发生的环境说明"><a href="#7-4-给出异常发生的环境说明" class="headerlink" title="7.4 给出异常发生的环境说明"></a>7.4 给出异常发生的环境说明</h2><p>每一个抛出的异常都应该有环境说明，以便判断错误的业务环境。</p>
<p>需要注意的是java的错误栈一般只能够得到堆栈跟踪，以定位到代码，故障定位也需要明确的业务环境。</p>
<h2 id="7-5-依调用者需要定义异常"><a href="#7-5-依调用者需要定义异常" class="headerlink" title="7.5 依调用者需要定义异常"></a>7.5 依调用者需要定义异常</h2><p>异常是用来被捕获的，所以定义异常最需要考虑的是它们如何被捕获，而不应该按照错误来源或者错误类型等来定义异常。</p>
<p>反例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ACMEPort port = <span class="keyword">new</span> ACMEPort(<span class="number">12</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    port.open();</span><br><span class="line">&#125; <span class="keyword">catch</span> (DeviceResponseException e) &#123;</span><br><span class="line">    reportPortError(e);</span><br><span class="line">    logger.log(<span class="string">&quot;Device response exception&quot;</span>, e);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ATM1212UnlockedException e) &#123;</span><br><span class="line">    reportPortError(e);</span><br><span class="line">    logger.log(<span class="string">&quot;Unlocked exception&quot;</span>, e);</span><br><span class="line">&#125; <span class="keyword">catch</span> (GMXError e) &#123;</span><br><span class="line">    reportPortError(e);</span><br><span class="line">    logger.log(<span class="string">&quot;Device response exception&quot;</span>, e);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改后：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">LocalPort port = <span class="keyword">new</span> LocalPort(<span class="number">12</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    port.open();</span><br><span class="line">&#125; <span class="keyword">catch</span> (PortDeviceFailure e) &#123;</span><br><span class="line">    reportPortError(e);</span><br><span class="line">    logger.log(e.getMessage(), e);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalPort</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ACMEPort innerPort;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LocalPort</span><span class="params">(<span class="keyword">int</span> portNumber)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.innerPort = <span class="keyword">new</span> ACMEPort(<span class="number">12</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">	    innerPort.open();</span><br><span class="line">	&#125; <span class="keyword">catch</span> (DeviceResponseException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> PortDeviceFailure(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ATM1212UnlockedException e) &#123;</span><br><span class="line">	    <span class="keyword">throw</span> <span class="keyword">new</span> PortDeviceFailure(e);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (GMXError e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> PortDeviceFailure(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-6-定义常规流程"><a href="#7-6-定义常规流程" class="headerlink" title="7.6 定义常规流程"></a>7.6 定义常规流程</h2><p>特例模式：</p>
<blockquote>
<p>即创建一个类或者配置一个对象，用来处理特例。</p>
</blockquote>
<p>即通过特例模式处理边界问题，将边缘地带的算法与核心算法分离开来，核心算法不负责异常和边缘检测。</p>
<p>反例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    MealExpences expences = expencesReportDao.getMaels(employee.getID());</span><br><span class="line">    total += expences.getTotal();</span><br><span class="line">&#125; <span class="keyword">catch</span> (MealExpencesNotFoundException e) &#123;</span><br><span class="line">    total += getMaelPerDiem();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正例：java 8的Optional。</p>
<h2 id="7-7-别返回null值"><a href="#7-7-别返回null值" class="headerlink" title="7.7 别返回null值"></a>7.7 别返回null值</h2><p>反例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Span nodeRoot = findNodeRoot(entry.getValue());</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">null</span> == nodeRoot) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> ConvertingZipkinSpanException(<span class="string">&quot;root span of endpoint [&quot;</span> + entry.getKey() + <span class="string">&quot;] not found&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以采用Optional.of(‘default_value’)，Collections.emptyList()等方法提到null值。</p>
<h2 id="7-8-别传递null值"><a href="#7-8-别传递null值" class="headerlink" title="7.8 别传递null值"></a>7.8 别传递null值</h2><p>这个比返回null值更糟糕，后果也跟严重。</p>
<p>如果传递了null值，可以使用PreCondition。如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> List&lt;SpanBo&gt; <span class="title">getSpans</span><span class="params">(TransactionEventKey key, List&lt;<span class="keyword">byte</span>[]&gt; hBaseFamilyList)</span> </span>&#123;</span><br><span class="line">    Preconditions.checkArgument(hBaseFamilyList != <span class="keyword">null</span>, <span class="string">&quot;hbase Family List may not be null.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Get get = <span class="keyword">new</span> Get(rowKeyDistributor.getDistributedKey(key.getBytes()));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> hbaseTemplate.get(HBaseTables.TRACES, get, spanMapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-9-小节"><a href="#7-9-小节" class="headerlink" title="7.9 小节"></a>7.9 小节</h2><p>将错误处理独立在主逻辑之外，独立看待。</p>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><h3 id="java的异常分类"><a href="#java的异常分类" class="headerlink" title="java的异常分类"></a><a target="_blank" rel="noopener" href="http://www.importnew.com/26613.html">java的异常分类</a></h3><p><img src="../pics/994bd262fec543853cd99fe680e857cc.png" alt="java Throwable"></p>
<p>checked exception: <code>Error</code>和<code>RuntimeException</code>，编译期间不会提示和发现。</p>
<p>unchecked exception: 除checked exception之外所有Throwable子类，编译期间就能够发现。</p>
<h3 id="java异常的最佳实践"><a href="#java异常的最佳实践" class="headerlink" title="java异常的最佳实践"></a><a target="_blank" rel="noopener" href="http://www.importnew.com/26775.html">java异常的最佳实践</a></h3><ul>
<li>在Finally块中清理资源或者使用try-with-resource语句</li>
<li>抛出异常是指定具体的异常，不要抛出Exception，RuntimeException等抽象异常</li>
<li>抛出异常是尽量包含能够定位到较为详细的业务点的描述信息</li>
<li>首先捕获最具体的异常，当有多个catch块中，按照捕获顺序只有第一个匹配到的catch块才能执行</li>
<li>不要捕获Throwable</li>
<li>不要生吞异常，即捕获异常后do nothing</li>
<li>不要记录并抛出异常，会导致记录多次日志</li>
<li>包装异常时不要抛弃原始的异常，定要把原始的异常设置为传入自定义异常，否则，丢失了原始的异常信息会让错误的分析变得困难。</li>
</ul>
<h1 id="八、Boundaries"><a href="#八、Boundaries" class="headerlink" title="八、Boundaries"></a>八、Boundaries</h1><p>Somehow we must integrate foreign code (third-party package or open source code, e.g.) with our own, this chapter we look at practice and tech to keep the boundaries of our software clean.</p>
<h2 id="8-1-Using-Third-Party-Code"><a href="#8-1-Using-Third-Party-Code" class="headerlink" title="8.1 Using Third-Party Code"></a>8.1 Using Third-Party Code</h2><p>Providers strive for broad applicability for wide users, but users always focus on their own needs.</p>
<p>For example, if our application build a <code>java.util.Map</code> object and pass it around, and want none receivers would delete elements of it, but <code>java.util.Map</code> has a <code>clear()</code> method. </p>
<p>We are not suggesting that every use of <code>java.util.Map</code> be encapsulated to passing between third-party code and your own, and also suggesting not to pass <code>java.util.Map</code> instance around your system. If you use a boundary interface like <code>Map</code>, keep it inside the class and ensure it be encapsulated.  Avoid returning it from, or accepting it as an argument to public APIs.</p>
<h2 id="8-2-Exploring-and-Learning-Boundaries"><a href="#8-2-Exploring-and-Learning-Boundaries" class="headerlink" title="8.2 Exploring and Learning Boundaries"></a>8.2 Exploring and Learning Boundaries</h2><p>It may be clear job to write tests for the third-party code we use.we could write some tests to explore our understanding of the third-party code, so called <em>learning tests</em>.</p>
<h2 id="8-3-Learning-log4j"><a href="#8-3-Learning-log4j" class="headerlink" title="8.3 Learning log4j"></a>8.3 Learning <code>log4j</code></h2><blockquote>
<p>coding-&gt; debug -&gt; error -&gt; learning -&gt; coding -&gt; … -&gt; debug -&gt; correct</p>
</blockquote>
<h2 id="8-4-Learning-Tests-Are-Better-Than-Free"><a href="#8-4-Learning-Tests-Are-Better-Than-Free" class="headerlink" title="8.4 Learning Tests Are Better Than Free"></a>8.4 Learning Tests Are Better Than Free</h2><p>The learning tests were precise experiments that helped increase our understanding:</p>
<ul>
<li>The learning tests were precise experiments that helped increase our understanding.</li>
<li>Learning tests verify that the third-party packages we are using work the way we expect them to.</li>
<li>A clean boundary should be supported by a set of outbound tests that exercise the interface the same way the production code does. </li>
</ul>
<h2 id="8-5-Using-Code-That-Does-Not-Yet-Exist"><a href="#8-5-Using-Code-That-Does-Not-Yet-Exist" class="headerlink" title="8.5 Using Code That Does Not Yet Exist"></a>8.5 Using Code That Does Not Yet Exist</h2><p>Why we use code does not exsists?</p>
<ul>
<li>There are often places in the code beyond our knowledge</li>
<li>The other side of the boundary is unknowable</li>
<li>We choose to look no farther than the boundary</li>
</ul>
<p>To keep from being blocked, we defined our own interface we wished. So that the interace is under our control, and  helps keep our own code more readable and focused on what it is trying to accomplish. </p>
<p>If nessary, an adapter should be introduced to interact with API beyond the boundary.</p>
<h2 id="8-6-Clean-Boundaries"><a href="#8-6-Clean-Boundaries" class="headerlink" title="8.6 Clean Boundaries"></a>8.6 Clean Boundaries</h2><p>Boundaries means change is out of control. </p>
<p>When facing boundaries, special care must be taken to protect and make sure future change is not too costly. </p>
<p>So we should avoid letting too much of our code know about the third-party particulars, and make sure our own system depend on our own code. </p>
<p>In order to approch this, manage third-party boundaries by having very few places, wrap them or use an adapter to convert from perfact interface.</p>
<h1 id="九、Unit-Tests"><a href="#九、Unit-Tests" class="headerlink" title="九、Unit Tests"></a>九、Unit Tests</h1><h2 id="9-1-The-Three-Laws-of-TDD"><a href="#9-1-The-Three-Laws-of-TDD" class="headerlink" title="9.1 The Three Laws of TDD"></a>9.1 The Three Laws of TDD</h2><ul>
<li>You may not write production code until you have written a failing unit test.<br>(测试先行，除非写到无法通过的测试，否则不要写生产代码)</li>
<li>You may not write more of a unit test than is sufficient to fail, and not compiling is failing<br>(一旦测试代码失败，就需要停止测试代码的编写，即使是单元测试代码的编译失败)</li>
<li>You may not write more production code than is sufficient to pass the currently failing test.<br>(一旦一个失败的单元测试运行通过，就需要返回测试代码的编写)</li>
</ul>
<h2 id="9-2-Keeping-Tests-Clean"><a href="#9-2-Keeping-Tests-Clean" class="headerlink" title="9.2 Keeping Tests Clean"></a>9.2 Keeping Tests Clean</h2><p>Having dirty tests is equivalent to, if not worse than, having no tests. </p>
<ul>
<li>Where does the problem come from: </li>
</ul>
<p>Tests must change as the production code evolves. From release to release the cost of maintaining team’s test suite rose. In the end they were forced to discard the test suite entirely.</p>
<p>Without a test suite they could not ensure that changes to one part of their system did not break other parts of their system, then the production code begin to rot. It was their decision to allow the tests to be messy that was the seed of that failure.</p>
<p>The condlusion is: test code is just as important as production code. It requires thought, design, and care. It must be kept as clean as production code. </p>
<ul>
<li>The benefits of test code：</li>
</ul>
<p>It is unit tests that keep production code flexible, maintainable, and reusable. If you have tests, you do not fear making changes to the code! The higher your test coverage, the less your fear. Tests enable all the -ilities, because tests enable change.</p>
<h2 id="9-3-Clean-Tests"><a href="#9-3-Clean-Tests" class="headerlink" title="9.3 Clean Tests"></a>9.3 Clean Tests</h2><p>What makes a clean test? Three things. Readability, readability, and readability.<br>What makes tests readable? The same thing that makes all code readable: <strong>clarity, simplicity, and density of expression.</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// USER --- A --- v1</span></span><br><span class="line"><span class="comment">//           \</span></span><br><span class="line"><span class="comment">//            \</span></span><br><span class="line"><span class="comment">//             v2</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">build_topology_with_one_span_of_two_virtual_node</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//given</span></span><br><span class="line">    List&lt;SpanBo&gt; spanBos = build_fake_SpanBo_with_two_virtual_node();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//when</span></span><br><span class="line">    Mockito.when(serviceTypeRegistryService.findServiceType((<span class="keyword">short</span>) <span class="number">1002</span>)).thenReturn(<span class="keyword">new</span> MockServiceType(<span class="keyword">true</span>));</span><br><span class="line">    Mockito.when(serviceTypeRegistryService.findServiceType((<span class="keyword">short</span>) <span class="number">1003</span>)).thenReturn(<span class="keyword">new</span> MockServiceType(<span class="keyword">false</span>));</span><br><span class="line"></span><br><span class="line">    Topology topology = useCase.createTopology(spanBos);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//then</span></span><br><span class="line">    checkNodes(topology.getNodes, <span class="number">4</span>);</span><br><span class="line">    checkLinks(topology.getLinks, <span class="number">3</span>);</span><br><span class="line">    checkDetail(topology);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The BUILD-OPERATE-CHECK pattern is made obvious by the structure of these tests. Every unit test should clearly split into these tree parts:</p>
<ul>
<li>the first part builds up the test data</li>
<li>the second part operates on that test data</li>
<li>the third part checks that the operation yielded the expected results.</li>
</ul>
<h3 id="9-3-1-Domain-Specific-Testing-Language"><a href="#9-3-1-Domain-Specific-Testing-Language" class="headerlink" title="9.3.1 Domain-Specific Testing Language"></a>9.3.1 Domain-Specific Testing Language</h3><p>Rather than using the APIs that programmers use to manipulate the system, we build up a set of functions and utilities that make use of those APIs and that make the tests more convenient to write and easier to read. These functions and utilities become a specialized API used by the tests. They are a testing language that programmers use to help themselves to write their tests and to help those who must read those tests later. Such as <code>checkNodes()</code> and <code>checkLinks()</code>.</p>
<h3 id="9-3-2-A-Dual-Standard"><a href="#9-3-2-A-Dual-Standard" class="headerlink" title="9.3.2 A Dual Standard"></a>9.3.2 A Dual Standard</h3><p>The code within the testing API does have a different standard than production code. It must still be <strong>simple, succinct(简洁), and expressive(富有表达力), but it need not be as efficient as production code</strong>.</p>
<p>There are things that you might never do in a production environment that are perfectly fine in a test environment.</p>
<h2 id="9-4-One-Assert-per-Test"><a href="#9-4-One-Assert-per-Test" class="headerlink" title="9.4 One Assert per Test"></a>9.4 One Assert per Test</h2><p>There is a school(流派) of thought that says every test function in a JUnit test should have one and only one assert statement.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetPageHierarchyAsXml</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    givenPages(<span class="string">&quot;PageOne&quot;</span>, <span class="string">&quot;PageOne.ChildOne&quot;</span>, <span class="string">&quot;PageTwo&quot;</span>);</span><br><span class="line"></span><br><span class="line">    whenRequestIsIssued(<span class="string">&quot;root&quot;</span>, <span class="string">&quot;type:pages&quot;</span>);</span><br><span class="line"></span><br><span class="line">    thenResponseShouldBeXML();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetPageHierarchyHasRightTags</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    givenPages(<span class="string">&quot;PageOne&quot;</span>, <span class="string">&quot;PageOne.ChildOne&quot;</span>, <span class="string">&quot;PageTwo&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    whenRequestIsIssued(<span class="string">&quot;root&quot;</span>, <span class="string">&quot;type:pages&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    thenResponseShouldContain(</span><br><span class="line">        <span class="string">&quot;&lt;name&gt;PageOne&lt;/name&gt;&quot;</span>, <span class="string">&quot;&lt;name&gt;PageTwo&lt;/name&gt;&quot;</span>, <span class="string">&quot;&lt;name&gt;ChildOne&lt;/name&gt;&quot;</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can use the TEMPLATE METHOD pattern and putting the given/when parts in the base class, and the then parts in different derivatives. Or we could create a completely separate test class and put the given and when parts in the <code>@Before</code> function. </p>
<p>The auther thinks that single assert rule is a good guideline, the best thing we can say is that the number of asserts in a test ought to be minimized.</p>
<h3 id="9-4-1-Single-Concept-per-Test"><a href="#9-4-1-Single-Concept-per-Test" class="headerlink" title="9.4.1 Single Concept per Test"></a>9.4.1 Single Concept per Test</h3><p>A better rule is that we want to test a single concept in each test function. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Miscellaneous tests for the addMonths() method.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddMonths</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SerialDate d1 = SerialDate.createInstance(<span class="number">31</span>, <span class="number">5</span>, <span class="number">2004</span>);</span><br><span class="line">    </span><br><span class="line">    SerialDate d2 = SerialDate.addMonths(<span class="number">1</span>, d1);</span><br><span class="line">    assertEquals(<span class="number">30</span>, d2.getDayOfMonth());</span><br><span class="line">    assertEquals(<span class="number">6</span>, d2.getMonth());</span><br><span class="line">    assertEquals(<span class="number">2004</span>, d2.getYYYY());</span><br><span class="line">    </span><br><span class="line">    SerialDate d3 = SerialDate.addMonths(<span class="number">2</span>, d1);</span><br><span class="line">    assertEquals(<span class="number">31</span>, d3.getDayOfMonth());</span><br><span class="line">    assertEquals(<span class="number">7</span>, d3.getMonth());</span><br><span class="line">    assertEquals(<span class="number">2004</span>, d3.getYYYY());</span><br><span class="line">    </span><br><span class="line">    SerialDate d4 = SerialDate.addMonths(<span class="number">1</span>, SerialDate.addMonths(<span class="number">1</span>, d1));</span><br><span class="line">    assertEquals(<span class="number">30</span>, d4.getDayOfMonth());</span><br><span class="line">    assertEquals(<span class="number">7</span>, d4.getMonth());</span><br><span class="line">    assertEquals(<span class="number">2004</span>, d4.getYYYY());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So probably the best rule is that one should minimize the number of asserts per concept and test just one concept per test function.</p>
<h2 id="9-5-F-I-R-S-T"><a href="#9-5-F-I-R-S-T" class="headerlink" title="9.5 F.I.R.S.T."></a>9.5 F.I.R.S.T.</h2><ul>
<li><strong>Fast</strong> Tests should be fast. </li>
<li><strong>Independent</strong> Tests should not depend on each other. </li>
<li><strong>Repeatable</strong> Tests should be repeatable in any environment.</li>
<li><strong>Self-Validating</strong> The tests should have a boolean output.</li>
<li><strong>Timely</strong> The tests need to be written in a timely fashion.</li>
</ul>
<h2 id="9-6-Conclusion"><a href="#9-6-Conclusion" class="headerlink" title="9.6 Conclusion"></a>9.6 Conclusion</h2><p>Tests are as important to the health of a project as the production code is. Perhaps they are even more important, because tests preserve and enhance the flexibility, maintainability, and reusability of the production code. </p>
<p>Keep your tests clean.</p>
<h1 id="十、Classes"><a href="#十、Classes" class="headerlink" title="十、Classes"></a>十、Classes</h1><h2 id="10-1-类的组织"><a href="#10-1-类的组织" class="headerlink" title="10.1 类的组织"></a>10.1 类的组织</h2><ul>
<li>类应该从一组变量的列表开始</li>
<li>公有静态变量应该放在前面，然后是私有静态变量，以及私有实例变量，很少有公有实例变量</li>
<li>公有方法应该在变量列表之后</li>
<li>私有工具方法放在其调用者之后</li>
<li>尽量保证变量和方法的私有性</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZipkinSpanAsyncConsumer</span> <span class="keyword">implements</span> <span class="title">StorageAdapters</span>.<span class="title">SpanConsumer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">long</span> WAIT_TIME = <span class="number">30L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String ZIPKIN_AGENT = <span class="string">&quot;zipkin_agent&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(ZipkinSpanAsyncConsumer.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;collector.zipkin.aysncWorker.queue.size:10240&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> zipkinWorkerQueueSize;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ZipkinTraceDao zipkinTraceDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;zipkinTraceEventConsumer&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> EventConsumer consumer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> TransactionEventCache&lt;TransactionEventKey, TransactionEventValue&gt; cache;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ThreadPoolExecutor workers;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BlockingQueue&lt;Runnable&gt; blockingQueue;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.blockingQueue = <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;(<span class="keyword">this</span>.zipkinWorkerQueueSize);</span><br><span class="line">        <span class="keyword">this</span>.workers = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">                <span class="number">1</span>,</span><br><span class="line">                <span class="number">1</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                TimeUnit.SECONDS,</span><br><span class="line">                <span class="keyword">this</span>.blockingQueue,</span><br><span class="line">                <span class="keyword">new</span> PinpointThreadFactory(<span class="string">&quot;zipkin async worker&quot;</span>));</span><br><span class="line"></span><br><span class="line">        Executors.newSingleThreadScheduledExecutor()</span><br><span class="line">                .scheduleAtFixedRate(() -&gt; &#123;</span><br><span class="line">                    logger.info(<span class="string">&quot;zipkin async workers queue size: [&#123;&#125;]&quot;</span>, <span class="keyword">this</span>.blockingQueue.size());</span><br><span class="line">                &#125;, ONE_MINUTE_MS, ONE_MINUTE_MS, TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(List&lt;Span&gt; spans)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (Span span : spans) &#123;</span><br><span class="line">            workers.submit(() -&gt; &#123;</span><br><span class="line">                <span class="comment">// 1), insert zipkin span to temporary table</span></span><br><span class="line">                zipkinTraceDao.insert(span);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 2), put root span into eventBus</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">null</span> == span.parentId) &#123;</span><br><span class="line">                    putToEventBus(span);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">putToEventBus</span><span class="params">(Span span)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == cache) &#123;</span><br><span class="line">            cache = <span class="keyword">new</span> TransactionEventCache&lt;&gt;(consumer);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Optional&lt;Long&gt; acceptTime = Optional.ofNullable(span.timestamp);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> localTime = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        TransactionEventKey key = <span class="keyword">new</span> TransactionEventKey(ZIPKIN_AGENT, acceptTime.orElse(localTime), span.traceId);</span><br><span class="line">        TransactionEventValue value = <span class="keyword">new</span> TransactionEventValue(key, ZIPKIN_AGENT, acceptTime.orElse(localTime));</span><br><span class="line">        cache.put(key, value, WAIT_TIME, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-2-类应该短小"><a href="#10-2-类应该短小" class="headerlink" title="10.2 类应该短小"></a>10.2 类应该短小</h2><p>关于类的第一条规则应该是短小。</p>
<p>类名应当描述其权责，如<code>ZipkinSpanAsyncConsumer</code>。如果您感到无法为某个类命名，说明它还是太大。此外类名越含糊，说明其职责越不明确，如带有processor，manager等的类。</p>
<h3 id="10-2-1-单一权责原则"><a href="#10-2-1-单一权责原则" class="headerlink" title="10.2.1 单一权责原则"></a>10.2.1 单一权责原则</h3><p>内容： 类或者模块应该有且只有一条被修改的理由。</p>
<p>单一职责原则是OO设计中最为重要的概念之一，但是也是最容易被破坏的类的设计原则。下面的示例就是一个职责过多的类：</p>
<p><img src="../pics/2018-10-26_085430.png" alt="一个权责过多的类"></p>
<p>OO的目标之一：系统应该由很多短小的类而不是少量巨大的类组成，每个类都封装者一个权责，并且只有一个被修改的原因，并与少数其他类一起协作达成期望的系统行为。</p>
<h3 id="10-2-2-内聚"><a href="#10-2-2-内聚" class="headerlink" title="10.2.2 内聚"></a>10.2.2 内聚</h3><p>类应该只有少量的实例变量。类中的每一个方法都应该操作一个或者多个实例变量。如果类中的每一个变量都被每一个方法所使用，这个类就拥有最大的内聚性。内聚性高意味着类中的方法和变量。</p>
<p>内聚性高意味着类中的方法和变量相互依、相互结合成的一个逻辑整体。如果有时候需要为一组子集方法而增加实例变量的时候，就可以将这些实例和变量拆分到新的类里，以便让类更加聚合。</p>
<h3 id="10-2-3-保存内聚性就会得到许多短小的类"><a href="#10-2-3-保存内聚性就会得到许多短小的类" class="headerlink" title="10.2.3 保存内聚性就会得到许多短小的类"></a>10.2.3 保存内聚性就会得到许多短小的类</h3><h2 id="10-3-为了修改而组织"><a href="#10-3-为了修改而组织" class="headerlink" title="10.3 为了修改而组织"></a>10.3 为了修改而组织</h2><p>对于多数系统，修改将一直持续。</p>
<p>如果类中出现了只与一小部分功能有关的私有方法，意味着存在改进的空间。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sql</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Sql</span><span class="params">(String table, Column[] columns)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">create</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">insert</span><span class="params">(Object[] fields)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">selectAll</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">findByKey</span><span class="params">(String keyColumn, String keyValue)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">select</span><span class="params">(Column column, String pattern)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">select</span><span class="params">(Criteria criteria)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">preparedInsert</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="keyword">private</span> String <span class="title">columnList</span><span class="params">(Column[] columns)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">private</span> String <span class="title">valuesList</span><span class="params">(Object[] fields, <span class="keyword">final</span> Column[] columns)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">private</span> String <span class="title">selectWithCriteria</span><span class="params">(String criteria)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">private</span> String <span class="title">placeholderList</span><span class="params">(Column[] columns)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>

<p>重构后：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sql</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Sql</span><span class="params">(String table, Column[] columns)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">abstract</span> <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateSql</span> <span class="keyword">extends</span> <span class="title">Sql</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CreateSql</span><span class="params">(String table, Column[] columns)</span></span></span><br><span class="line"><span class="function">    @Override </span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class SelectSql extends Sql </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SelectSql</span><span class="params">(String table, Column[] columns)</span></span></span><br><span class="line"><span class="function">    @Override </span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class InsertSql extends Sql </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">InsertSql</span><span class="params">(String table, Column[] columns, Object[] fields)</span></span></span><br><span class="line"><span class="function">    @Override </span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="keyword">private</span> String <span class="title">valuesList</span><span class="params">(Object[] fields, <span class="keyword">final</span> Column[] columns)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class SelectWithCriteriaSql extends Sql </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SelectWithCriteriaSql</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    String table, Column[] columns, Criteria criteria)</span></span></span><br><span class="line"><span class="function">    @Override </span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class SelectWithMatchSql extends Sql </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SelectWithMatchSql</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    String table, Column[] columns, Column column, String pattern)</span></span></span><br><span class="line"><span class="function">    @Override </span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class FindByKeySql extends Sql</span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> <span class="title">FindByKeySql</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    String table, Column[] columns, String keyColumn, String keyValue)</span></span></span><br><span class="line"><span class="function">    @Override </span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class PreparedInsertSql extends Sql </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PreparedInsertSql</span><span class="params">(String table, Column[] columns)</span></span></span><br><span class="line"><span class="function">    @Override </span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">placeholderList</span><span class="params">(Column[] columns)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class Where </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Where</span><span class="params">(String criteria)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class ColumnList </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ColumnList</span><span class="params">(Column[] columns)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">generate</span><span class="params">()</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>

<p>上面的示例，通过子类化的手段，是的重构后的Sql类对于新功能开放，而不是修改原来繁杂的Sql类。<br>重构后的Sql支持了面向对象的开放-闭合原则：<strong>类应该对扩展开放，对修改闭合</strong>。</p>
<hr>
<h1 id="十一、系统"><a href="#十一、系统" class="headerlink" title="十一、系统"></a>十一、系统</h1><h2 id="待补充"><a href="#待补充" class="headerlink" title="* 待补充 *"></a><strong>* 待补充 *</strong></h2><h1 id="十二、迭进"><a href="#十二、迭进" class="headerlink" title="十二、迭进"></a>十二、迭进</h1><p>通过迭进设计达到整洁目的<br>简单设计的四条规则：</p>
<h2 id="12-1-运行所有测试"><a href="#12-1-运行所有测试" class="headerlink" title="12.1  运行所有测试"></a>12.1  运行所有测试</h2><ul>
<li> 只要系统可测试，就会导向保持类短小而且目的单一的设计方案。</li>
<li> 遵循SRP(单一职责原则）的类，测试起来较为简单。</li>
<li> 测试编写的越多，就越能持续走向编写较易测试的业务代码。</li>
<li> 确保系统完全可测试能帮助我们创建更好的设计。</li>
<li> 紧耦合的代码难以编写测试，编写测试越多，就越会遵循DIP（依赖倒置原则）之类规则，使用依赖注入，接口和抽象等工具尽可能减少耦合，系统就会更贴近OO低耦合度，高内聚度的目标。</li>
<li> 编写测试导致更好的设计。</li>
</ul>
<h2 id="12-2-不可重复"><a href="#12-2-不可重复" class="headerlink" title="12.2 不可重复"></a>12.2 不可重复</h2><ul>
<li>重复是拥有良好设计系统的大敌。</li>
<li>要想创建整洁的系统，需要有消除重复的意愿。</li>
<li>模板方法模式一种移除高层级重复的通用技巧。</li>
</ul>
<h2 id="12-3-表达了程序员的意图"><a href="#12-3-表达了程序员的意图" class="headerlink" title="12.3 表达了程序员的意图"></a>12.3 表达了程序员的意图</h2><ul>
<li><p>软件项目的主要成本在于长期维护。</p>
</li>
<li><p>提高表达力的方法：</p>
<ul>
<li>选用好类名和好函数名  保存类和函数的尺寸短小    </li>
<li>采用标准命名法来表达（COMMAND / VISITOR）  </li>
<li>编写良好的单元测试（测试的主要目的之一就是通过实例起到文档的作用，读到测试的人应该能很快理解某个类是做什么的）</li>
</ul>
</li>
<li><p>尊重自己的手艺，用心是最珍贵的资源。</p>
</li>
<li><p>个人理解：对代码要有敬畏心。</p>
</li>
</ul>
<h2 id="12-4-尽可能减少类和方法的数量"><a href="#12-4-尽可能减少类和方法的数量" class="headerlink" title="12.4 尽可能减少类和方法的数量"></a>12.4 尽可能减少类和方法的数量</h2><ul>
<li>为了保持类和函数短小，我们可能会创造出太多的细小类和方法。</li>
<li>类和方法的数量太多，有时是由毫无意义的教条主义导致的。</li>
<li>我们的目标是在保持函数和类短小的同时，保持整个系统的短小精悍。</li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/refactor/" rel="tag"># refactor</a>
              <a href="/tags/clean-code/" rel="tag"># clean_code</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2018/07/22/mood/2018-07-22-welcome/" rel="prev" title="Welcome to my blogger!">
                  <i class="fa fa-chevron-left"></i> Welcome to my blogger!
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2018/12/02/golang/2018-12-02-timeseed/" rel="next" title="Golang Rand Seed!">
                  Golang Rand Seed! <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bruce Qian</span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  

<script src="/js/local-search.js"></script>






  






<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.css">

<script>
NexT.utils.loadComments('#gitalk-container', () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '566ec257445badffee98',
      clientSecret: 'd3f485d706e7ec94d5e4d9f5dfa989907f05b8c7',
      repo        : 'qianguodong.github.io',
      owner       : 'qianguodong',
      admin       : ['bruce'],
      id          : 'd3dc66f953ceb511a6934e5a38979e43',
        language: 'en',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
