<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"guodongq.github.io","root":"/","images":"/images","scheme":"Mist","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="An important part of the development process is testing, how to ensure the quality of the code, how to ensure that each function can run and the results are correct, and how to ensure the best perfo">
<meta property="og:type" content="article">
<meta property="og:title" content="Testing!">
<meta property="og:url" content="https://guodongq.github.io/2019/07/29/golang/2019-07-29-testing/index.html">
<meta property="og:site_name" content="小布之家">
<meta property="og:description" content="An important part of the development process is testing, how to ensure the quality of the code, how to ensure that each function can run and the results are correct, and how to ensure the best perfo">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-07-29T02:22:16.000Z">
<meta property="article:modified_time" content="2021-01-29T23:41:43.761Z">
<meta property="article:author" content="Bruce">
<meta property="article:tag" content="unit_test">
<meta property="article:tag" content="testing">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://guodongq.github.io/2019/07/29/golang/2019-07-29-testing/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<title>Testing! | 小布之家</title>
  



  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">小布之家</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#testing"><span class="nav-number">1.</span> <span class="nav-text">testing</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%87%86%E5%88%99"><span class="nav-number">1.1.</span> <span class="nav-text">单元测试准则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BE%E4%BE%8B"><span class="nav-number">1.2.</span> <span class="nav-text">举例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">1.2.1.</span> <span class="nav-text">执行功能测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Pprof"><span class="nav-number">1.3.</span> <span class="nav-text">Pprof</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%94%9F%E6%88%90%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.1.</span> <span class="nav-text">命令行生成测试数据文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%88%86%E6%9E%90"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">命令行分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pprof%E4%BA%A4%E4%BA%92%E6%A8%A1%E5%BC%8F%E5%88%86%E6%9E%90"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">pprof交互模式分析</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.2.</span> <span class="nav-text">代码生成测试数据文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8ECI%E9%9B%86%E6%88%90"><span class="nav-number">1.4.</span> <span class="nav-text">与CI集成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#go-junit-report"><span class="nav-number">1.4.1.</span> <span class="nav-text">go-junit-report</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gocover-cobertura"><span class="nav-number">1.4.2.</span> <span class="nav-text">gocover-cobertura</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#goreporter"><span class="nav-number">1.4.3.</span> <span class="nav-text">goreporter</span></a></li></ol></li></ol></li></ol></div>
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Bruce"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Bruce</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/qianguodong" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;qianguodong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:goldon.qian@gmail.com" title="E-Mail → mailto:goldon.qian@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://guodongq.github.io/2019/07/29/golang/2019-07-29-testing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Bruce">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小布之家">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Testing!
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-29 10:22:16" itemprop="dateCreated datePublished" datetime="2019-07-29T10:22:16+08:00">2019-07-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-01-30 07:41:43" itemprop="dateModified" datetime="2021-01-30T07:41:43+08:00">2021-01-30</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <a id="more"></a>

<p>An important part of the development process is testing, how to ensure the quality of the code, how to ensure that each function can run and the results are correct, and how to ensure the best performance of the written code.   </p>
<p>The focus of unit testing is to discover logic errors in programming or implementation, to expose problems early, and to facilitate problem location. The focus of performance testing is to find some problems in programming, so that online programs can be in high concurrency. It can still be stable.</p>
<h1 id="testing"><a href="#testing" class="headerlink" title="testing"></a>testing</h1><h2 id="单元测试准则"><a href="#单元测试准则" class="headerlink" title="单元测试准则"></a>单元测试准则</h2><ul>
<li>文件名必须<code>_test.go</code>结尾</li>
<li>必须<code>import testing</code>包</li>
<li>所有的测试用例函数必须Test开头</li>
<li>测试用例会按照源代码中定义的顺序依次执行</li>
<li>测试函数<code>TestXXX()</code>函数入参为<code>testing.T</code></li>
<li>测试格式<code>func TestXXX(t *testing.T)</code>,<code>XXX</code>部分可以为任意的字母数字组合，但是首字母必须为大写<code>[A-Z]</code></li>
<li>函数中通过调用<code>testing.T</code>的Error, Errorf, FailNow, Fatal, FatalIf方法，说明测试不通过，调用Log方法用来记录测试的信息</li>
<li>go test命令执行的测试目标，默认为package级别，直接执行不带任何参数，会尝试执行当前目录所在的package的所有测试用例</li>
<li>go test只会在当前或用户指定的目录下查找测试函数，不会去查找子目录  </li>
<li>go test -run可以指定package中执行的函数名，如：<code>go test -run &quot;^TestA|TestB$&quot;</code>,执行名为TestA和TestB的测试函数</li>
<li>go test -v 会输出执行过程信息</li>
<li>go test -cover可以用来统计行覆盖率</li>
<li>go test 具体用法可以参考<code>go test --help</code>查询帮助信息进行查看</li>
</ul>
<h2 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 生产代码</span><br><span class="line">package cal</span><br><span class="line"></span><br><span class="line">func Add(a, b int) int&#123;</span><br><span class="line">	return a + b</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 功能测试</span><br><span class="line">package cal</span><br><span class="line"></span><br><span class="line">import &quot;testing&quot;</span><br><span class="line"></span><br><span class="line">func TestAdd(t *testing.T)&#123;</span><br><span class="line">	expected :&#x3D; 5</span><br><span class="line">	actual :&#x3D; Add(3,4)</span><br><span class="line">	if expected !&#x3D; actual&#123;</span><br><span class="line">		t.Errorf(&quot;Add(3,4) got:%v, expected:%v&quot;, actual,expected)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; 性能测试</span><br><span class="line">package cal</span><br><span class="line"></span><br><span class="line">import &quot;testing&quot;</span><br><span class="line"></span><br><span class="line">func Benchmark(b *testing.B)&#123;</span><br><span class="line">	for i :&#x3D; 0; i &lt; b.N; i++&#123;</span><br><span class="line">		Add(4, 5)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="执行功能测试"><a href="#执行功能测试" class="headerlink" title="执行功能测试"></a>执行功能测试</h3><ul>
<li><code>go test -v</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜ src&gt; go test -v .&#x2F;cal</span><br><span class="line">&#x3D;&#x3D;&#x3D; RUN   TestAdd</span><br><span class="line">--- FAIL: TestAdd (0.00s)</span><br><span class="line">    add_test.go:12: Add(3,4) got:7, expected:5</span><br><span class="line">FAIL</span><br><span class="line">FAIL	cal	0.007s</span><br></pre></td></tr></table></figure>



<ul>
<li>执行指定函数<code>go test -run</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜ src&gt; go test -run TestAdd .&#x2F;testcase</span><br><span class="line">### 输出 ###</span><br><span class="line">--- FAIL: TestAdd (0.00s)</span><br><span class="line">    main_test.go:9: Add(3,4) got:7, expected:5</span><br><span class="line">FAIL</span><br><span class="line">FAIL    gitlab.zte.com.cn&#x2F;testcase      0.147s</span><br></pre></td></tr></table></figure>

<ul>
<li>执行性能测试<code>go test -brench</code><ul>
<li>benchmem：输出内存分配统计</li>
<li>benchtime：指定测试时间</li>
<li>cpu：指定GOMAXPROCS</li>
<li>timeout：超时限制</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜ src&gt; go test -v -bench&#x3D;.  -cpu&#x3D;8 -benchtime&#x3D;&quot;3s&quot; -timeout&#x3D;&quot;5s&quot; -benchmem</span><br><span class="line">### 输出 ###</span><br><span class="line">&#x3D;&#x3D;&#x3D; RUN   TestAdd</span><br><span class="line">--- PASS: TestAdd (0.00s)</span><br><span class="line">goos: windows</span><br><span class="line">goarch: 386</span><br><span class="line">pkg: github.com&#x2F;testcase</span><br><span class="line">Benchmark-8     1000000000               0.31 ns&#x2F;op            0 B&#x2F;op          0</span><br><span class="line">allocs&#x2F;op</span><br><span class="line">PASS</span><br><span class="line">ok      github.com&#x2F;testcase      1.144s</span><br></pre></td></tr></table></figure>

<h2 id="Pprof"><a href="#Pprof" class="headerlink" title="Pprof"></a>Pprof</h2><h3 id="命令行生成测试数据文件"><a href="#命令行生成测试数据文件" class="headerlink" title="命令行生成测试数据文件"></a>命令行生成测试数据文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜ src&gt; go test -bench&#x3D;. -cpuprofile cpu.out</span><br><span class="line">### 输出 ###</span><br><span class="line">goos: windows</span><br><span class="line">goarch: 386</span><br><span class="line">pkg: github.com&#x2F;testcase</span><br><span class="line">Benchmark-4     2000000000               0.31 ns&#x2F;op</span><br><span class="line">PASS</span><br><span class="line">ok      github.com&#x2F;testcase      1.590s</span><br></pre></td></tr></table></figure>

<h4 id="命令行分析"><a href="#命令行分析" class="headerlink" title="命令行分析"></a>命令行分析</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">➜ src&gt; go tool pprof -text cpu.out</span><br><span class="line">### 输出 ###</span><br><span class="line">Type: cpu</span><br><span class="line">Time: May 30, 2019 at 3:19pm (CST)</span><br><span class="line">Duration: 800.05ms, Total samples &#x3D; 690ms (86.25%)</span><br><span class="line">Showing nodes accounting for 690ms, 100% of 690ms total</span><br><span class="line">      flat  flat%   sum%        cum   cum%</span><br><span class="line">     650ms 94.20% 94.20%      650ms 94.20%  github.com&#x2F;testcase.Benchmark</span><br><span class="line"></span><br><span class="line">      10ms  1.45% 95.65%       10ms  1.45%  runtime.findrunnable</span><br><span class="line">      10ms  1.45% 97.10%       10ms  1.45%  runtime.heapBitsSetType</span><br><span class="line">      10ms  1.45% 98.55%       10ms  1.45%  runtime.siftupTimer</span><br><span class="line">      10ms  1.45%   100%       10ms  1.45%  runtime&#x2F;pprof.(*profMap).lookup</span><br><span class="line">         0     0%   100%       20ms  2.90%  runtime.(*timersBucket).addtimerLocked</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime.malg</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime.mallocgc</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime.mcall</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime.newobject</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime.newproc</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime.newproc.func1</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime.newproc1</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime.park_m</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime.schedule</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime.systemstack</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime&#x2F;pprof.(*profileBuilder).addCPUData</span><br><span class="line">         0     0%   100%       30ms  4.35%  runtime&#x2F;pprof.profileWriter</span><br><span class="line">         0     0%   100%      650ms 94.20%  testing.(*B).launch</span><br><span class="line">         0     0%   100%      650ms 94.20%  testing.(*B).runN</span><br><span class="line">         0     0%   100%       20ms  2.90%  time.Sleep</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="pprof交互模式分析"><a href="#pprof交互模式分析" class="headerlink" title="pprof交互模式分析"></a>pprof交互模式分析</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">➜ src&gt; go tool pprof main_test.go cpu.out</span><br><span class="line">### 输出 ###</span><br><span class="line">main_test.go: parsing profile: unrecognized profile format</span><br><span class="line">Fetched 1 source profiles out of 2</span><br><span class="line">Type: cpu</span><br><span class="line">Time: May 30, 2019 at 3:19pm (CST)</span><br><span class="line">Duration: 800.05ms, Total samples &#x3D; 690ms (86.25%)</span><br><span class="line">Entering interactive mode (type &quot;help&quot; for commands, &quot;o&quot; for options)</span><br><span class="line">(pprof) top</span><br><span class="line">Showing nodes accounting for 690ms, 100% of 690ms total</span><br><span class="line">Showing top 10 nodes out of 21</span><br><span class="line">      flat  flat%   sum%        cum   cum%</span><br><span class="line">     650ms 94.20% 94.20%      650ms 94.20%  github.com&#x2F;testcase.Benchmark</span><br><span class="line"></span><br><span class="line">      10ms  1.45% 95.65%       10ms  1.45%  runtime.findrunnable</span><br><span class="line">      10ms  1.45% 97.10%       10ms  1.45%  runtime.heapBitsSetType</span><br><span class="line">      10ms  1.45% 98.55%       10ms  1.45%  runtime.siftupTimer</span><br><span class="line">      10ms  1.45%   100%       10ms  1.45%  runtime&#x2F;pprof.(*profMap).lookup</span><br><span class="line">         0     0%   100%       20ms  2.90%  runtime.(*timersBucket).addtimerLocked</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime.malg</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime.mallocgc</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime.mcall</span><br><span class="line">         0     0%   100%       10ms  1.45%  runtime.newobject</span><br><span class="line">(pprof)</span><br></pre></td></tr></table></figure>

<h3 id="代码生成测试数据文件"><a href="#代码生成测试数据文件" class="headerlink" title="代码生成测试数据文件"></a>代码生成测试数据文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line">import (</span><br><span class="line">    &quot;os&quot;</span><br><span class="line">    &quot;runtime&#x2F;pprof&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">    w, _ :&#x3D; os.Create(&quot;cpu.out&quot;)</span><br><span class="line">    defer w.Close()</span><br><span class="line">    pprof.StartCPUProfile(w)</span><br><span class="line">    defer pprof.StopCPUProfile()</span><br><span class="line"></span><br><span class="line">    w2, _ :&#x3D; os.Create(&quot;mem.out&quot;)</span><br><span class="line">    defer w2.Close()</span><br><span class="line">    defer pprof.WriteHeapProfile(w2)</span><br><span class="line"></span><br><span class="line">    Add(3, 5)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func Add(a, b int) int &#123;</span><br><span class="line">    return a + b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译并执行以上文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">go build main.go   </span><br><span class="line">.&#x2F;main  </span><br><span class="line">ls（.&#x2F;main命令生成cpu.out和mem.out文件）  </span><br><span class="line">cpu.out     mem.out     pprof       pprof.go  </span><br></pre></td></tr></table></figure>

<p>生成pdf文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go tool pprof -pdf cpu.out &gt; cpu.pdf  </span><br><span class="line">go tool pprof -pdf mem.out &gt; mem.pdf  </span><br></pre></td></tr></table></figure>

<h2 id="与CI集成"><a href="#与CI集成" class="headerlink" title="与CI集成"></a>与CI集成</h2><h3 id="go-junit-report"><a href="#go-junit-report" class="headerlink" title="go-junit-report"></a>go-junit-report</h3><p>类似java的junit，go test可以与go-junit-report工具结合生成junit报告，然后集成到jenkins中进行查看</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export GOPATH&#x3D;$(pwd)</span><br><span class="line">ut_modules&#x3D;&#96;go list src&#x2F;...&#96;</span><br><span class="line">go test -v $&#123;ut_modules[*&#125;&#125; 2 &gt;&amp;1 | go-junit-report &gt; go_junit.xml</span><br></pre></td></tr></table></figure>


<h3 id="gocover-cobertura"><a href="#gocover-cobertura" class="headerlink" title="gocover-cobertura"></a>gocover-cobertura</h3><p>也可以类似和cobertura进行集成,生成coverage.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">export GOPATH&#x3D;$(pwd)</span><br><span class="line">ut_modules&#x3D;&#96;go list src&#x2F;...&#96;</span><br><span class="line">go test -coverprofile&#x3D;coverage.txt -covermode count $&#123;ut_modules[*&#125;&#125;</span><br><span class="line">gocover-cobertura &lt; coverage.txt &gt; coverage.xml</span><br></pre></td></tr></table></figure>

<h3 id="goreporter"><a href="#goreporter" class="headerlink" title="goreporter"></a>goreporter</h3><p>可以和goreporter集成，生成html格式的报告文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export GOPATH&#x3D;$(pwd)</span><br><span class="line">goreporter -p $&#123;projectRelativePath&#125;  -r $&#123;report_dir&#125; -f html</span><br></pre></td></tr></table></figure>




    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/unit-test/" rel="tag"># unit_test</a>
              <a href="/tags/testing/" rel="tag"># testing</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/07/21/golang/2019-07-21-duplicate/" rel="prev" title="Deduplicate slice elements!">
                  <i class="fa fa-chevron-left"></i> Deduplicate slice elements!
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/07/30/golang/2019-07-30-beego/" rel="next" title="Beego!">
                  Beego! <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bruce</span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  

<script src="/js/local-search.js"></script>






  






<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.css">

<script>
NexT.utils.loadComments('#gitalk-container', () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1.7.0/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '566ec257445badffee98',
      clientSecret: 'd3f485d706e7ec94d5e4d9f5dfa989907f05b8c7',
      repo        : 'qianguodong.github.io',
      owner       : 'qianguodong',
      admin       : ['bruce'],
      id          : '58f8c81e2be04fd1244d18668a35d7eb',
        language: 'en',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
